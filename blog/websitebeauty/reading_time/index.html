
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="知足且上进，温柔且坚定">
      
      
        <meta name="author" content="王科文(Wcowin)">
      
      
        <link rel="canonical" href="http://wcowin.work/blog/websitebeauty/reading_time/">
      
      
        <link rel="prev" href="../Mkdocs-AI-Summary/">
      
      
        <link rel="next" href="../../../develop/regex/">
      
      
      <link rel="icon" href="https://i.stardots.io/wcowin/1750090373988.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Mkdocs 阅读时间插件 - Wcowin's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra2.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/stylesheets/link.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/stylesheets/customize.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/stylesheets/ziti.css">
    
      <link rel="stylesheet" href="https://fontsapi.zeoseven.com/292/main/result.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-29HZMNR0KG"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-29HZMNR0KG",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-29HZMNR0KG",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Wcowin&#39;s Blog" class="md-header__button md-logo" aria-label="Wcowin's Blog" data-md-component="logo">
      
  <img src="https://pica.zhimg.com/80/v2-74ecd899c7c4cc0258930eaff239a21b_1440w.webp" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Wcowin's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mkdocs 阅读时间插件
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="关闭自动模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="关闭自动模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M160 0c17.7 0 32 14.3 32 32v32h128c17.7 0 32 14.3 32 32s-14.3 32-32 32h-9.6l-8.4 23.1c-16.4 45.2-41.1 86.5-72.2 122 14.2 8.8 29 16.6 44.4 23.5l50.4 22.4 62.2-140c5.1-11.6 16.6-19 29.2-19s24.1 7.4 29.2 19l128 288c7.2 16.2-.1 35.1-16.2 42.2s-35.1-.1-42.2-16.2l-20-45H337.3l-20 45c-7.2 16.2-26.1 23.4-42.2 16.2s-23.4-26.1-16.2-42.2l39.8-89.5-50.4-22.4c-23-10.2-45-22.4-65.8-36.4-21.3 17.2-44.6 32.2-69.5 44.7l-34.7 17.2c-15.8 7.9-35 1.5-42.9-14.3s-1.5-35 14.3-42.9l34.5-17.3c16.3-8.2 31.8-17.7 46.4-28.3-13.8-12.7-26.8-26.4-38.9-40.9l-10.1-12.2c-11.3-13.6-9.5-33.8 4.1-45.1s33.8-9.5 45.1 4.1l10.2 12.2c11.5 13.9 24.1 26.8 37.4 38.7 27.5-30.4 49.2-66.1 63.5-105.4l.5-1.2H32.1C14.3 128 0 113.7 0 96s14.3-32 32-32h96V32c0-17.7 14.3-32 32-32m256 270.8L365.7 384h100.6z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="javascript:translateTo('chinese_simplified');" hreflang="zh" class="md-select__link">
              中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="javascript:translateTo('english');" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="javascript:translateTo('japanese');" hreflang="ja" class="md-select__link">
              日本語
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Wcowin/Wcowin.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Wcowin.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../indexblog/" class="md-tabs__link">
          
  
  
    
  
  技术

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../develop/" class="md-tabs__link">
          
  
  
    
  
  开发

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../relax/" class="md-tabs__link">
          
  
  
    
  
  闲聊

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../trip/" class="md-tabs__link">
          
  
  
    
  
  旅行

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../tag/" class="md-tabs__link">
        
  
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../waline/" class="md-tabs__link">
        
  
  
    
  
  留言板

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../link/" class="md-tabs__link">
          
  
  
    
  
  朋友

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../about/geren/" class="md-tabs__link">
          
  
  
    
  
  关于

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://wcowin.work/Mkdocs-Wcowin/" class="md-tabs__link">
        
  
  
    
  
  Mkdocs中文教程

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://www.travellings.cn/go.html" class="md-tabs__link">
        
  
  
    
  
  开往

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Wcowin&#39;s Blog" class="md-nav__button md-logo" aria-label="Wcowin's Blog" data-md-component="logo">
      
  <img src="https://pica.zhimg.com/80/v2-74ecd899c7c4cc0258930eaff239a21b_1440w.webp" alt="logo">

    </a>
    Wcowin's Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Wcowin/Wcowin.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Wcowin.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    技术
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            技术
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../indexblog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    导览
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../temp-email/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    临时邮箱是什么？
    
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="最近添加">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Webplay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    好用/好玩网站分享
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/comkdocs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基于Mkdocs主题的站点
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/ttq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    甜甜圈🍩代码
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../macsoft/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mac/windows软件网站汇总
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../yuque/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    语雀
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Cryptography/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    密码学
    
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="最近添加">
    </span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_8" id="__nav_1_8_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_8">
            <span class="md-nav__icon md-icon"></span>
            密码学
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Cryptography/Numbertheory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    数论基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Cryptography/Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    密码学引言
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Cryptography/Symmetriccryptography/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    流密码
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Cryptography/Groupcipher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分组密码
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_9" >
        
          
          <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    MKdocs教程
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_9">
            <span class="md-nav__icon md-icon"></span>
            MKdocs教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mkdocs/MIT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MIT许可声明
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mkdocs/mkfirst/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.Mkdocs教程前言
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mkdocs/mkdocs1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.利用Mkdocs部署静态网页
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mkdocs/mkdocs2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.Mkdocs配置说明(mkdocs.yml)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mkdocs/mkdocs3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.解决Github Pages部署mkdocs自定义域名失效的问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mkdocs/mkdocsblog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    网站添加Mkdocs博客
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_10" checked>
        
          
          <label class="md-nav__link" for="__nav_1_10" id="__nav_1_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Mkdocs美化/补充
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_10">
            <span class="md-nav__icon md-icon"></span>
            Mkdocs美化/补充
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mkdocs-wcowin1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Wcowin for MkDocs主题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mkdocs-translate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    为MKdocs添加多语言翻译
    
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="最近添加">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mkdocs-document-dates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MkDocs文档日期插件
    
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="最近添加">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GoogleAD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    为网站添加Google广告
    
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="最近添加">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../recommend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    添加相关推荐文章
    
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="最近添加">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Mkdocs-AI-Summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MkDocs文档AI摘要
    
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="最近添加">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    添加阅读信息统计
    
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="最近添加">
    </span>
  

  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    添加阅读信息统计
    
  </span>
  
    
  
  
    <span class="md-status md-status--new" title="最近添加">
    </span>
  

  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 基础配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. 基础配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      步骤1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      步骤2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      步骤3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      步骤4
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. 效果展示
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      3.高级配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.高级配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 排除特定页面
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 自定义统计信息
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../develop/regex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    正则表达式基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mkdocs/linktech/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何给MKdocs添加友链
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Customdomain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何自定义域名
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../yuanjiaohua/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    网页圆角化设计
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mkcomments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    添加评论系统(giscus为例)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../header/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    添加顶部公告栏
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webtalknow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    添加在线聊天
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mkdocsfont/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    修改网站字体
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shubiao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JS实现鼠标样式
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backgroud/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    背景特效
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mkpdf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    嵌入PDF文件
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Relativeaddress/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    相对地址的一些问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../404/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    添加404页面
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../time/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    为MKdocs添加文章修订时间戳
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../footer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    页脚设置
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../accelerate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    加速网站访问的一些心得
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_11" >
        
          
          <label class="md-nav__link" for="__nav_1_11" id="__nav_1_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    技术分享
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_11">
            <span class="md-nav__icon md-icon"></span>
            技术分享
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/win/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Win11镜像下载/KMS激活
    
  </span>
  
    
  
  
    <span class="md-status md-status--deprecated" title="已弃用">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/jiaoben/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    实用脚本分享
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/tuchuang/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    搭建个人图床
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/ohmuzsh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    oh-my-zsh 更新
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/googletranslate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    解决谷歌翻译用不了的问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/aixin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    爱心代码
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/matlabrose/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    用Matlab画玫瑰百合花
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/kexue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    科学上网
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technique%20sharing/jisuanjibiannianshi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    计算机编年史
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_12" >
        
          
          <label class="md-nav__link" for="__nav_1_12" id="__nav_1_12_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    学术
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_12">
            <span class="md-nav__icon md-icon"></span>
            学术
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Academic/LaTeX/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LaTeX常用符号整理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://mirrors.sjtug.sjtu.edu.cn/ctan/info/install-latex-guide-zh-cn/install-latex-guide-zh-cn.pdf" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    一份简短的关于LATEX安装的介绍
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Academic/%E5%B8%8C%E8%85%8A%E5%AD%97%E6%AF%8D.pdf" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    希腊字母总结
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Academic/math/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Math
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../Academic/Math/14/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    数学竞赛
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Academic/diancichang.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    电磁场期末复习索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Academic/ddiancichang/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    电磁场期末公式总结(手写)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_13" >
        
          
          <label class="md-nav__link" for="__nav_1_13" id="__nav_1_13_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Mac
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_13">
            <span class="md-nav__icon md-icon"></span>
            Mac
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://mp.weixin.qq.com/s/qjSx09tqNq1KfVug2WtQFg" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mac电脑安装软件报错解决办法汇总
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/Pd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PD虚拟机
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/sunhuai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    提示 「“XXX”已损坏,无法打开。 您应该将它移到废纸篓。」「打不开 xxx,因为它来自身份不明的开发者」解决方法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/shanchu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Macbook启动台顽固应用图标删除方法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/homebrew/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Homebrew国内如何自动安装(国内地址)(Mac & Linux)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/jiasugithub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mac 无法访问 github 的解决办法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/Macesc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mac的esc键失效的解决方法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/Launchpad/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    启动台图标顺序错乱怎么办
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/jietu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mac小技巧:去除系统截图名的日期后缀
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/xjiq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    小小Mac技巧
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/maccd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mac隐藏彩蛋
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Mac/kjj/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mac 键盘快捷键
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_14" >
        
          
          <label class="md-nav__link" for="__nav_1_14" id="__nav_1_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    iPhone
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_14">
            <span class="md-nav__icon md-icon"></span>
            iPhone
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../iphone/iphoneduozhanghao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    iphone多账号如何不频繁登录,双重认证
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../iphone/iphonexianmian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    苹果iphone /iOS 限免网站合集
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../iphone/iphonequchukaiping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    苹果手机如何去除开屏广告
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_15" >
        
          
          <label class="md-nav__link" for="__nav_1_15" id="__nav_1_15_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    WIN
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_15">
            <span class="md-nav__icon md-icon"></span>
            WIN
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Win/360/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    彻底卸载360安全卫士的方法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Win/edgexz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    三步卸载 Microsoft Edge
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Win/winkjj/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows快捷键
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_16" >
        
          
          <label class="md-nav__link" for="__nav_1_16" id="__nav_1_16_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_16">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../py/python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    将Python文件.py打包成.exe可执行程序
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../py/pip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PIP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../develop/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    开发
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../relax/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    闲聊
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../trip/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    旅行
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    标签
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../waline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    留言板
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../link/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    朋友
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../about/geren/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://wcowin.work/Mkdocs-Wcowin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mkdocs中文教程
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.travellings.cn/go.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    开往
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 基础配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. 基础配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      步骤1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      步骤2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      步骤3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      步骤4
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. 效果展示
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      3.高级配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.高级配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 排除特定页面
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 自定义统计信息
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
        <a href="../../../tag/#tag:mkdocs" class="md-tag">Mkdocs</a>
      
    
  </nav>


  
  


<h1 id="_1">添加阅读信息统计<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<div class="admonition info">
<p class="admonition-title">💾 AI智能摘要 (GLM-4)</p>
<p>本文介绍了如何为Markdown文档添加阅读时间统计功能。通过配置mkdocs.yml和编写Python脚本，可自动计算并展示阅读时间、中文字符数和代码行数，适用于排除特定页面路径的需求。</p>
</div>
<div class="admonition tip">
<p class="admonition-title">📖 阅读信息</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span>阅读时间：<strong>1</strong> 分钟 | <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span>中文字符：<strong>150</strong> | <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span>有效代码行数：<strong>268</strong></p>
</div>
<h2 id="1">1. 基础配置<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<h3 id="1_1"><strong>步骤1</strong><a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h3>
<p>创建reading_time.py</p>
<details class="note">
<summary>reading_time.py</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">  1</a></span>
<span class="normal"><a href="#__codelineno-0-2">  2</a></span>
<span class="normal"><a href="#__codelineno-0-3">  3</a></span>
<span class="normal"><a href="#__codelineno-0-4">  4</a></span>
<span class="normal"><a href="#__codelineno-0-5">  5</a></span>
<span class="normal"><a href="#__codelineno-0-6">  6</a></span>
<span class="normal"><a href="#__codelineno-0-7">  7</a></span>
<span class="normal"><a href="#__codelineno-0-8">  8</a></span>
<span class="normal"><a href="#__codelineno-0-9">  9</a></span>
<span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lru_cache</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="c1"># 预编译正则表达式（性能优化版本）</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="n">EXCLUDE_PATTERNS</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^index\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^trip/index\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^relax/index\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/indexblog\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/posts\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^develop/index\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;waline\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;link\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;404\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="p">]</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="c1"># 高度优化的正则表达式（一次性编译）</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="n">CHINESE_CHARS_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\u4e00-\u9fff\u3400-\u4dbf]&#39;</span><span class="p">)</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="n">CODE_BLOCK_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;```.*?```&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="n">INLINE_CODE_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;`[^`]+`&#39;</span><span class="p">)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="n">YAML_FRONT_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^---.*?---\s*&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="n">HTML_TAG_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;[^&gt;]+&gt;&#39;</span><span class="p">)</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="n">IMAGE_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;!\[.*?\]\([^)]+\)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="n">LINK_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\[([^\]]+)\]\([^)]+\)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="c1"># 预定义排除类型</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="n">EXCLUDE_TYPES</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">({</span><span class="s1">&#39;landing&#39;</span><span class="p">,</span> <span class="s1">&#39;special&#39;</span><span class="p">,</span> <span class="s1">&#39;widget&#39;</span><span class="p">})</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="c1"># 扩展非编程行内代码词汇（更全面的过滤）</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="n">NON_CODE_WORDS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">({</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="s1">&#39;markdown&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;blank&#39;</span><span class="p">,</span> <span class="s1">&#39;lg&#39;</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="s1">&#39;large&#39;</span><span class="p">,</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span> <span class="s1">&#39;secondary&#39;</span><span class="p">,</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;danger&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="s1">&#39;dark&#39;</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="s1">&#39;cards&#39;</span><span class="p">,</span> <span class="s1">&#39;octicons&#39;</span><span class="p">,</span> <span class="s1">&#39;bookmark&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;img&#39;</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="s1">&#39;alt&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="p">})</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="c1"># 支持的编程和标记语言（扩展版本）</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="n">PROGRAMMING_LANGUAGES</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">({</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="c1"># 编程语言</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;py&#39;</span><span class="p">,</span> <span class="s1">&#39;javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;js&#39;</span><span class="p">,</span> <span class="s1">&#39;typescript&#39;</span><span class="p">,</span> <span class="s1">&#39;ts&#39;</span><span class="p">,</span> <span class="s1">&#39;java&#39;</span><span class="p">,</span> <span class="s1">&#39;cpp&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="s1">&#39;rust&#39;</span><span class="p">,</span> <span class="s1">&#39;php&#39;</span><span class="p">,</span> <span class="s1">&#39;ruby&#39;</span><span class="p">,</span> <span class="s1">&#39;swift&#39;</span><span class="p">,</span> <span class="s1">&#39;kotlin&#39;</span><span class="p">,</span> <span class="s1">&#39;csharp&#39;</span><span class="p">,</span> <span class="s1">&#39;cs&#39;</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="c1"># 脚本语言</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="s1">&#39;bash&#39;</span><span class="p">,</span> <span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="s1">&#39;powershell&#39;</span><span class="p">,</span> <span class="s1">&#39;ps1&#39;</span><span class="p">,</span> <span class="s1">&#39;zsh&#39;</span><span class="p">,</span> <span class="s1">&#39;fish&#39;</span><span class="p">,</span> <span class="s1">&#39;bat&#39;</span><span class="p">,</span> <span class="s1">&#39;cmd&#39;</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="c1"># 标记和配置语言</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;css&#39;</span><span class="p">,</span> <span class="s1">&#39;scss&#39;</span><span class="p">,</span> <span class="s1">&#39;sass&#39;</span><span class="p">,</span> <span class="s1">&#39;less&#39;</span><span class="p">,</span> <span class="s1">&#39;yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;yml&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;xml&#39;</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="s1">&#39;toml&#39;</span><span class="p">,</span> <span class="s1">&#39;ini&#39;</span><span class="p">,</span> <span class="s1">&#39;conf&#39;</span><span class="p">,</span> <span class="s1">&#39;dockerfile&#39;</span><span class="p">,</span> <span class="s1">&#39;makefile&#39;</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="c1"># 数据库和查询</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="s1">&#39;sql&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">,</span> <span class="s1">&#39;sqlite&#39;</span><span class="p">,</span> <span class="s1">&#39;mongodb&#39;</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="c1"># 其他</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;matlab&#39;</span><span class="p">,</span> <span class="s1">&#39;scala&#39;</span><span class="p">,</span> <span class="s1">&#39;perl&#39;</span><span class="p">,</span> <span class="s1">&#39;lua&#39;</span><span class="p">,</span> <span class="s1">&#39;dart&#39;</span><span class="p">,</span> <span class="s1">&#39;tex&#39;</span><span class="p">,</span> <span class="s1">&#39;latex&#39;</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="c1"># 数据格式</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="c1"># 无标识符（空字符串也算作有效语言）</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="s1">&#39;&#39;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="p">})</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="k">def</span><span class="w"> </span><span class="nf">clean_markdown_content_for_chinese</span><span class="p">(</span><span class="n">content_hash</span><span class="p">,</span> <span class="n">markdown</span><span class="p">):</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;清理Markdown内容，只保留中文文本用于统计（添加缓存）&quot;&quot;&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">markdown</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="c1"># 使用预编译的正则表达式</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">YAML_FRONT_PATTERN</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">HTML_TAG_PATTERN</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">IMAGE_PATTERN</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">LINK_PATTERN</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">CODE_BLOCK_PATTERN</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">INLINE_CODE_PATTERN</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="k">return</span> <span class="n">content</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="k">def</span><span class="w"> </span><span class="nf">count_code_lines</span><span class="p">(</span><span class="n">markdown</span><span class="p">):</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;统计代码行数（修复版本 - 正确处理所有代码行）&quot;&quot;&quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">code_blocks</span> <span class="o">=</span> <span class="n">CODE_BLOCK_PATTERN</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">total_code_lines</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">code_blocks</span><span class="p">):</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="c1"># 提取语言标识</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">lang_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^```(\w*)&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">language</span> <span class="o">=</span> <span class="n">lang_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">lang_match</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="c1"># 移除开头的语言标识和结尾的```</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">code_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^```\w*\n?&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">code_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\n?```$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">code_content</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="c1"># 过滤空代码块</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">code_content</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="k">continue</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="c1"># 计算有效行数（包含所有非空行，包括注释行）</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">code_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">line_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="c1"># 如果有明确的编程语言标识，直接统计</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="k">if</span> <span class="n">language</span> <span class="ow">and</span> <span class="n">language</span> <span class="ow">in</span> <span class="n">PROGRAMMING_LANGUAGES</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">total_code_lines</span> <span class="o">+=</span> <span class="n">line_count</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="k">continue</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="c1"># 增强的检测策略 - 更宽松的判断</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">is_code</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="c1"># 1. 命令行检测</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">command_indicators</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s1">&#39;sudo &#39;</span><span class="p">,</span> <span class="s1">&#39;npm &#39;</span><span class="p">,</span> <span class="s1">&#39;pip &#39;</span><span class="p">,</span> <span class="s1">&#39;git &#39;</span><span class="p">,</span> <span class="s1">&#39;cd &#39;</span><span class="p">,</span> <span class="s1">&#39;ls &#39;</span><span class="p">,</span> <span class="s1">&#39;mkdir &#39;</span><span class="p">,</span> <span class="s1">&#39;rm &#39;</span><span class="p">,</span> <span class="s1">&#39;cp &#39;</span><span class="p">,</span> <span class="s1">&#39;mv &#39;</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="s1">&#39;chmod &#39;</span><span class="p">,</span> <span class="s1">&#39;chown &#39;</span><span class="p">,</span> <span class="s1">&#39;grep &#39;</span><span class="p">,</span> <span class="s1">&#39;find &#39;</span><span class="p">,</span> <span class="s1">&#39;ps &#39;</span><span class="p">,</span> <span class="s1">&#39;kill &#39;</span><span class="p">,</span> <span class="s1">&#39;top &#39;</span><span class="p">,</span> <span class="s1">&#39;cat &#39;</span><span class="p">,</span> <span class="s1">&#39;echo &#39;</span><span class="p">,</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="s1">&#39;wget &#39;</span><span class="p">,</span> <span class="s1">&#39;curl &#39;</span><span class="p">,</span> <span class="s1">&#39;tar &#39;</span><span class="p">,</span> <span class="s1">&#39;zip &#39;</span><span class="p">,</span> <span class="s1">&#39;unzip &#39;</span><span class="p">,</span> <span class="s1">&#39;ssh &#39;</span><span class="p">,</span> <span class="s1">&#39;scp &#39;</span><span class="p">,</span> <span class="s1">&#39;rsync &#39;</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="s1">&#39;xattr &#39;</span><span class="p">,</span> <span class="s1">&#39;codesign &#39;</span><span class="p">,</span> <span class="s1">&#39;xcode-select &#39;</span><span class="p">,</span> <span class="s1">&#39;spctl &#39;</span><span class="p">,</span> <span class="s1">&#39;launchctl &#39;</span><span class="p">,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="s1">&#39;brew &#39;</span><span class="p">,</span> <span class="s1">&#39;defaults &#39;</span><span class="p">,</span> <span class="s1">&#39;ditto &#39;</span><span class="p">,</span> <span class="s1">&#39;hdiutil &#39;</span><span class="p">,</span> <span class="s1">&#39;diskutil &#39;</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="s1">&#39;dir &#39;</span><span class="p">,</span> <span class="s1">&#39;copy &#39;</span><span class="p">,</span> <span class="s1">&#39;xcopy &#39;</span><span class="p">,</span> <span class="s1">&#39;del &#39;</span><span class="p">,</span> <span class="s1">&#39;rd &#39;</span><span class="p">,</span> <span class="s1">&#39;md &#39;</span><span class="p">,</span> <span class="s1">&#39;type &#39;</span><span class="p">,</span> <span class="s1">&#39;attrib &#39;</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="s1">&#39;$ &#39;</span><span class="p">,</span> <span class="s1">&#39;# &#39;</span><span class="p">,</span> <span class="s1">&#39;% &#39;</span><span class="p">,</span> <span class="s1">&#39;&gt; &#39;</span><span class="p">,</span> <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;PS&gt;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="s1">&#39;--force&#39;</span><span class="p">,</span> <span class="s1">&#39;--deep&#39;</span><span class="p">,</span> <span class="s1">&#39;--sign&#39;</span><span class="p">,</span> <span class="s1">&#39;--master-disable&#39;</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="s1">&#39;/Applications/&#39;</span><span class="p">,</span> <span class="s1">&#39;/usr/&#39;</span><span class="p">,</span> <span class="s1">&#39;/etc/&#39;</span><span class="p">,</span> <span class="s1">&#39;/var/&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/&#39;</span><span class="p">,</span> <span class="s1">&#39;~/&#39;</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;.app&#39;</span><span class="p">,</span> <span class="s1">&#39;.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;.pkg&#39;</span><span class="p">,</span> <span class="s1">&#39;.dmg&#39;</span><span class="p">,</span> <span class="s1">&#39;.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;.tar&#39;</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="s1">&#39;#!/&#39;</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="p">]</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">indicator</span> <span class="ow">in</span> <span class="n">code_content</span> <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">command_indicators</span><span class="p">):</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">is_code</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="c1"># 2. 编程语法检测（增强版）</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_code</span><span class="p">:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">programming_indicators</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>                <span class="c1"># Python语法特征</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="s1">&#39;def &#39;</span><span class="p">,</span> <span class="s1">&#39;class &#39;</span><span class="p">,</span> <span class="s1">&#39;import &#39;</span><span class="p">,</span> <span class="s1">&#39;from &#39;</span><span class="p">,</span> <span class="s1">&#39;return &#39;</span><span class="p">,</span> <span class="s1">&#39;yield &#39;</span><span class="p">,</span> <span class="s1">&#39;lambda &#39;</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="s1">&#39;with &#39;</span><span class="p">,</span> <span class="s1">&#39;as &#39;</span><span class="p">,</span> <span class="s1">&#39;try:&#39;</span><span class="p">,</span> <span class="s1">&#39;except:&#39;</span><span class="p">,</span> <span class="s1">&#39;finally:&#39;</span><span class="p">,</span> <span class="s1">&#39;elif &#39;</span><span class="p">,</span> <span class="s1">&#39;if __name__&#39;</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                <span class="s1">&#39;print(&#39;</span><span class="p">,</span> <span class="s1">&#39;.append(&#39;</span><span class="p">,</span> <span class="s1">&#39;.extend(&#39;</span><span class="p">,</span> <span class="s1">&#39;.remove(&#39;</span><span class="p">,</span> <span class="s1">&#39;.sort(&#39;</span><span class="p">,</span> <span class="s1">&#39;.reverse(&#39;</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                <span class="s1">&#39;range(&#39;</span><span class="p">,</span> <span class="s1">&#39;len(&#39;</span><span class="p">,</span> <span class="s1">&#39;str(&#39;</span><span class="p">,</span> <span class="s1">&#39;int(&#39;</span><span class="p">,</span> <span class="s1">&#39;float(&#39;</span><span class="p">,</span> <span class="s1">&#39;list(&#39;</span><span class="p">,</span> <span class="s1">&#39;dict(&#39;</span><span class="p">,</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                <span class="c1"># JavaScript/TypeScript语法</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                <span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;var &#39;</span><span class="p">,</span> <span class="s1">&#39;let &#39;</span><span class="p">,</span> <span class="s1">&#39;const &#39;</span><span class="p">,</span> <span class="s1">&#39;async &#39;</span><span class="p">,</span> <span class="s1">&#39;await &#39;</span><span class="p">,</span> <span class="s1">&#39;=&gt;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="s1">&#39;console.log&#39;</span><span class="p">,</span> <span class="s1">&#39;document.&#39;</span><span class="p">,</span> <span class="s1">&#39;window.&#39;</span><span class="p">,</span> <span class="s1">&#39;require(&#39;</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>                <span class="c1"># 通用编程语法</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>                <span class="s1">&#39;public &#39;</span><span class="p">,</span> <span class="s1">&#39;private &#39;</span><span class="p">,</span> <span class="s1">&#39;protected &#39;</span><span class="p">,</span> <span class="s1">&#39;static &#39;</span><span class="p">,</span> <span class="s1">&#39;void &#39;</span><span class="p">,</span> <span class="s1">&#39;int &#39;</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="s1">&#39;string &#39;</span><span class="p">,</span> <span class="s1">&#39;boolean &#39;</span><span class="p">,</span> <span class="s1">&#39;float &#39;</span><span class="p">,</span> <span class="s1">&#39;double &#39;</span><span class="p">,</span> <span class="s1">&#39;char &#39;</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="c1"># 操作符和结构</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;||&#39;</span><span class="p">,</span> <span class="s1">&#39;++&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;+=&#39;</span><span class="p">,</span> <span class="s1">&#39;-=&#39;</span><span class="p">,</span> <span class="s1">&#39;**&#39;</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="c1"># 特殊结构</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="s1">&#39;while &#39;</span><span class="p">,</span> <span class="s1">&#39;for &#39;</span><span class="p">,</span> <span class="s1">&#39;if &#39;</span><span class="p">,</span> <span class="s1">&#39;else:&#39;</span><span class="p">,</span> <span class="s1">&#39;switch &#39;</span><span class="p">,</span> <span class="s1">&#39;case &#39;</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="c1"># HTML/XML语法</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="s1">&#39;&lt;!DOCTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;html&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;head&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;body&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;div&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;span&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;p&gt;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="s1">&#39;&lt;style&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;script&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;link&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;meta&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;img&#39;</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="c1"># CSS语法</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="s1">&#39;display:&#39;</span><span class="p">,</span> <span class="s1">&#39;color:&#39;</span><span class="p">,</span> <span class="s1">&#39;background:&#39;</span><span class="p">,</span> <span class="s1">&#39;margin:&#39;</span><span class="p">,</span> <span class="s1">&#39;padding:&#39;</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="s1">&#39;font-size:&#39;</span><span class="p">,</span> <span class="s1">&#39;width:&#39;</span><span class="p">,</span> <span class="s1">&#39;height:&#39;</span><span class="p">,</span> <span class="s1">&#39;position:&#39;</span><span class="p">,</span> <span class="s1">&#39;border:&#39;</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="c1"># YAML语法</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="s1">&#39;name:&#39;</span><span class="p">,</span> <span class="s1">&#39;version:&#39;</span><span class="p">,</span> <span class="s1">&#39;theme:&#39;</span><span class="p">,</span> <span class="s1">&#39;title:&#39;</span><span class="p">,</span> <span class="s1">&#39;description:&#39;</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="c1"># JSON语法</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="s1">&#39;{&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;}&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;:&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;,&#39;</span><span class="p">,</span> <span class="s1">&#39;[{&#39;</span><span class="p">,</span> <span class="s1">&#39;}]&#39;</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="c1"># 配置文件语法</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="s1">&#39;/*&#39;</span><span class="p">,</span> <span class="s1">&#39;*/&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;!--&#39;</span><span class="p">,</span> <span class="s1">&#39;--&gt;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="c1"># SQL语法</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="s1">&#39;SELECT &#39;</span><span class="p">,</span> <span class="s1">&#39;FROM &#39;</span><span class="p">,</span> <span class="s1">&#39;WHERE &#39;</span><span class="p">,</span> <span class="s1">&#39;INSERT &#39;</span><span class="p">,</span> <span class="s1">&#39;UPDATE &#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE &#39;</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="s1">&#39;CREATE &#39;</span><span class="p">,</span> <span class="s1">&#39;ALTER &#39;</span><span class="p">,</span> <span class="s1">&#39;DROP &#39;</span><span class="p">,</span> <span class="s1">&#39;INDEX &#39;</span><span class="p">,</span> <span class="s1">&#39;TABLE &#39;</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="c1"># 数学公式和LaTeX</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;$$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">frac&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">sum&#39;</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="p">]</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">indicator</span> <span class="ow">in</span> <span class="n">code_content</span> <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">programming_indicators</span><span class="p">):</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="n">is_code</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="c1"># 3. 结构化检测</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_code</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="c1"># 缩进结构检测</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">):</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="n">is_code</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="c1"># HTML标签结构</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="k">elif</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">in</span> <span class="n">code_content</span> <span class="ow">and</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">code_content</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="n">is_code</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="c1"># 包含特殊字符组合</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">char</span> <span class="ow">in</span> <span class="n">code_content</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">code_content</span> <span class="ow">or</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">code_content</span><span class="p">):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                <span class="n">is_code</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="c1"># 4. 模式匹配检测（宽松策略）</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_code</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">special_patterns</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                <span class="sa">r</span><span class="s1">&#39;\w+\(\)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\w+\[\]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\w+\{\}&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\w+=\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\w+:\w+&#39;</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                <span class="sa">r</span><span class="s1">&#39;&lt;\w+&gt;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\$\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;#\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;@\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\w+\.\w+\(\)&#39;</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="sa">r</span><span class="s1">&#39;\d+\.\d+\.\d+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;http[s]?://&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;ftp://&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="sa">r</span><span class="s1">&#39;def\s+\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;class\s+\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;import\s+\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;from\s+\w+&#39;</span><span class="p">,</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                <span class="sa">r</span><span class="s1">&#39;if\s+\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;while\s+\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;for\s+\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;return\s+\w*&#39;</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                <span class="sa">r</span><span class="s1">&#39;\w+\s*=\s*\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\w+\.\w+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;#.*输出&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;#.*结果&#39;</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="p">]</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">code_content</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">special_patterns</span><span class="p">):</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="n">is_code</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="c1"># 如果判断为代码，则统计行数</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="k">if</span> <span class="n">is_code</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="n">total_code_lines</span> <span class="o">+=</span> <span class="n">line_count</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="k">return</span> <span class="n">total_code_lines</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_reading_stats</span><span class="p">(</span><span class="n">markdown</span><span class="p">):</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;计算中文字符数和代码行数&quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="c1"># 生成内容哈希用于缓存</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">content_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="c1"># 使用缓存的清理函数</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">clean_content</span> <span class="o">=</span> <span class="n">clean_markdown_content_for_chinese</span><span class="p">(</span><span class="n">content_hash</span><span class="p">,</span> <span class="n">markdown</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">chinese_chars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">CHINESE_CHARS_PATTERN</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">clean_content</span><span class="p">))</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="c1"># 统计代码行数</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">code_lines</span> <span class="o">=</span> <span class="n">count_code_lines</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="c1"># 计算阅读时间（中文：400字/分钟）</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="n">reading_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">chinese_chars</span> <span class="o">/</span> <span class="mi">400</span><span class="p">))</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">return</span> <span class="n">reading_time</span><span class="p">,</span> <span class="n">chinese_chars</span><span class="p">,</span> <span class="n">code_lines</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="k">def</span><span class="w"> </span><span class="nf">on_page_markdown</span><span class="p">(</span><span class="n">markdown</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="n">page</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="c1"># 快速排除检查</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hide_reading_time&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">return</span> <span class="n">markdown</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="c1"># 保持原有的EXCLUDE_PATTERNS循环检查方式</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="n">src_path</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">src_path</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">EXCLUDE_PATTERNS</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">src_path</span><span class="p">):</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="k">return</span> <span class="n">markdown</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="c1"># 优化类型检查</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="n">page_type</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">if</span> <span class="n">page_type</span> <span class="ow">in</span> <span class="n">EXCLUDE_TYPES</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">return</span> <span class="n">markdown</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="c1"># 快速预检查</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">return</span> <span class="n">markdown</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="c1"># 计算统计信息</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="n">reading_time</span><span class="p">,</span> <span class="n">chinese_chars</span><span class="p">,</span> <span class="n">code_lines</span> <span class="o">=</span> <span class="n">calculate_reading_stats</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="c1"># 过滤太短的内容</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="k">if</span> <span class="n">chinese_chars</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="k">return</span> <span class="n">markdown</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="c1"># 生成阅读信息</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="k">if</span> <span class="n">code_lines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">reading_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;!!! info &quot;📖 阅读信息&quot;</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="s2">    阅读时间：**</span><span class="si">{</span><span class="n">reading_time</span><span class="si">}</span><span class="s2">** 分钟 | 中文字符：**</span><span class="si">{</span><span class="n">chinese_chars</span><span class="si">}</span><span class="s2">** | 有效代码行数：**</span><span class="si">{</span><span class="n">code_lines</span><span class="si">}</span><span class="s2">**</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">reading_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;!!! info &quot;📖 阅读信息&quot;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="s2">    阅读时间：**</span><span class="si">{</span><span class="n">reading_time</span><span class="si">}</span><span class="s2">** 分钟 | 中文字符：**</span><span class="si">{</span><span class="n">chinese_chars</span><span class="si">}</span><span class="s2">**</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="k">return</span> <span class="n">reading_info</span> <span class="o">+</span> <span class="n">markdown</span>
</code></pre></div></td></tr></table></div>
</details>
<h3 id="2"><strong>步骤2</strong><a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p>把reading_time.py放到docs/overrides/hooks目录下，然后在mkdocs.yml中添加：  </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># 在 mkdocs.yml 中添加</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nt">hooks</span><span class="p">:</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docs/overrides/hooks/reading_time.py</span><span class="w">    </span><span class="c1"># 阅读时间统计</span>
</code></pre></div></td></tr></table></div>
<h3 id="3"><strong>步骤3</strong><a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<p>配置MkDocs主题以及覆写路径custom_dir
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># 在 mkdocs.yml 中添加</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="nt">theme</span><span class="p">:</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">material</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="nt">custom_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docs/overrides</span><span class="w">  </span><span class="c1"># 必需配置！！！</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="nt">features</span><span class="p">:</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content.code.copy</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content.code.select</span>
</code></pre></div></td></tr></table></div></p>
<p>到这里检查下目录树状图:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>$ tree -a
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>文件名
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>├── .github
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>│   ├── .DS_Store
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>│   └── workflows
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>│       └── ci.yml
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>├── docs
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>│   └── index.md
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>|   └── overrides
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>│       └── hooks
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>│           └── reading_time.py
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>│           └── ...
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>└── mkdocs.yml
</code></pre></div></td></tr></table></div></p>
<h3 id="4"><strong>步骤4</strong><a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>mkdocs<span class="w"> </span>serve<span class="w">  </span><span class="c1"># 本地预览</span>
</code></pre></div></td></tr></table></div>
<h2 id="2_1">2. 效果展示<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h2>
<p><img alt="image" src="https://s1.imagehub.cc/images/2025/06/06/a4584dbad4da3f87eb5c2f1e7ed14a74.png" /></p>
<h2 id="3_1">3.高级配置<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 排除特定页面<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<p>如果有一些页面不想统计阅读时间，可以在页面的元数据中添加 <code>hide_reading_time: true</code>。例如：  </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>---
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>title: 不统计阅读时间的页面
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="gu">hide_reading_time: true</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="gu">---</span>
</code></pre></div></td></tr></table></div>
<p>或者直接在reading_time.py中添加：<br />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># 你想排除的页面路径</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">EXCLUDE_PATTERNS</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^index\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^trip/index\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^relax/index\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/indexblog\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/posts\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^develop/index\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;waline\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;link\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;404\.md$&#39;</span><span class="p">),</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="p">]</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="32">3.2 自定义统计信息<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<p>如果需要自定义统计信息的格式，可以修改reading_time.py中的calculate_reading_stats函数。例如：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_reading_stats</span><span class="p">(</span><span class="n">markdown</span><span class="p">):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="c1"># 计算统计信息</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>    <span class="n">reading_time</span><span class="p">,</span> <span class="n">chinese_chars</span><span class="p">,</span> <span class="n">code_lines</span> <span class="o">=</span> <span class="n">calculate_reading_stats</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span> 
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span class="c1"># 自定义统计信息格式</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>    <span class="k">if</span> <span class="n">code_lines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>        <span class="n">reading_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;!!! info &quot;📖 阅读信息&quot;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="s2">    阅读时间：**</span><span class="si">{</span><span class="n">reading_time</span><span class="si">}</span><span class="s2">** 分钟 | 中文字符：**</span><span class="si">{</span><span class="n">chinese_chars</span><span class="si">}</span><span class="s2">** | 有效代码行数：**</span><span class="si">{</span><span class="n">code_lines</span><span class="si">}</span><span class="s2">**</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>        <span class="n">reading_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;!!! info &quot;📖 阅读信息&quot;</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="s2">    阅读时间：**</span><span class="si">{</span><span class="n">reading_time</span><span class="si">}</span><span class="s2">** 分钟 | 中文字符：**</span><span class="si">{</span><span class="n">chinese_chars</span><span class="si">}</span><span class="s2">**</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>    <span class="k">return</span> <span class="n">reading_info</span> <span class="o">+</span> <span class="n">markdown</span>
</code></pre></div></td></tr></table></div></p>
<style>
.related-posts {
  margin-top: 1.5rem;
  padding-top: 0.75rem;
  border-top: 1px solid rgba(0,0,0,0.1);
  max-height: none !important; /* 防止Safari错误计算高度 */
  overflow: visible !important; /* 防止内容被截断 */
}
.related-posts h3 {
  margin-top: 0;
  margin-bottom: 0.5rem;
  font-size: 1.2rem;
  font-weight: 500;
  line-height: 1.3;
}
.related-posts ul {
  margin: 0 0 0.5rem 0 !important; /* 强制覆盖可能的冲突样式 */
  padding-left: 1.5rem;
  list-style-position: outside;
}
.related-posts li {
  margin-bottom: 0.25rem;
  line-height: 1.4;
}
/* 暗色模式适配 */
[data-md-color-scheme="slate"] .related-posts {
  border-top-color: rgba(255,255,255,0.1);
}
/* Safari特定修复 */
@supports (-webkit-hyphens:none) {
  .related-posts {
    display: block;
    position: relative;
    height: auto !important;
  }
  .related-posts ul {
    position: static;
  }
}
</style>
<div class="related-posts">
<h3>📚 相关文章推荐</h3>
<ul>
<li><a href="/blog/websitebeauty/Relativeaddress/">相对地址的一些问题</a></li>
<li><a href="/blog/websitebeauty/mkdocs-document-dates/">MkDocs文档日期插件</a></li>
<li><a href="/blog/websitebeauty/mkdocs-translate/">为MKdocs添加多语言翻译</a></li>
<li><a href="/blog/Mkdocs/mkdocs1/">利用Mkdocs部署静态网页至GitHubpages</a></li>
<li><a href="/blog/technique%20sharing/comkdocs/">基于 Mkdocs 的主题与站点</a></li>
</ul>
</div>

<!-- Twikoo 评论系统 -->
<div class="twikoo-container" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(0,0,0,0.1);">
    <h3 style="margin-bottom: 1rem; font-size: 1.2rem; font-weight: 500;">💬 评论</h3>
    <div id="tcomment" class="loading" style="min-height: 200px;">
        <p style="text-align: center; color: #666; padding: 2rem;">评论系统加载中...</p>
    </div>
</div>

<style>
.twikoo-container {
    max-width: 100%;
}

/* 暗色模式适配 */
[data-md-color-scheme="slate"] .twikoo-container {
    border-top-color: rgba(255,255,255,0.1);
}

/* 加载状态样式 */
#tcomment.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.02);
    border-radius: 8px;
}

[data-md-color-scheme="slate"] #tcomment.loading {
    background: rgba(255,255,255,0.05);
}
</style>

<script>
(function() {
    // 防止重复加载
    if (window.twikooLoaded) {
        return;
    }

    function loadTwikoo() {
        // 检查是否已经加载过 Twikoo
        if (window.twikoo) {
            initTwikoo();
            return;
        }

        const script = document.createElement('script');
        script.src = 'https://registry.npmmirror.com/twikoo/1.6.44/files/dist/twikoo.min.js';
        script.onload = function() {
            console.log('Twikoo 脚本加载成功');
            initTwikoo();
        };
        script.onerror = function() {
            console.error('Twikoo 脚本加载失败');
            const commentEl = document.getElementById('tcomment');
            if (commentEl) {
                commentEl.classList.remove('loading');
                commentEl.innerHTML = '<p style="text-align: center; color: #f56565; padding: 2rem;">评论系统加载失败，请刷新页面重试</p>';
            }
        };
        document.head.appendChild(script);
    }

    function initTwikoo() {
        const commentEl = document.getElementById('tcomment');
        if (!commentEl) {
            console.warn('评论容器未找到');
            return;
        }

        commentEl.classList.remove('loading');

        try {
            twikoo.init({
                envId: 'https://superb-salamander-e730b6.netlify.app/.netlify/functions/twikoo',
                el: '#tcomment',
                lang: 'zh-CN',
                path: location.pathname,
                onCommentLoaded: function () {
                    console.log('评论加载完成');
                },
                onError: function(err) {
                    console.error('Twikoo 初始化失败:', err);
                    commentEl.innerHTML = '<p style="text-align: center; color: #f56565; padding: 2rem;">评论系统初始化失败，请检查网络连接</p>';
                }
            });
            window.twikooLoaded = true;
        } catch (error) {
            console.error('Twikoo 初始化异常:', error);
            commentEl.innerHTML = '<p style="text-align: center; color: #f56565; padding: 2rem;">评论系统初始化异常</p>';
        }
    }

    // 页面加载完成后初始化
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadTwikoo);
    } else {
        loadTwikoo();
    }
})();
</script>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="2025年7月8日 16:41:35 UTC">2025-07-08</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="2025年6月6日 09:07:20 UTC">2025-06-06</span>
  </span>

    
    
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="贡献者">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a href="https://github.com/Wcowin" class="md-author" title="@Wcowin">
          
          <img src="https://avatars.githubusercontent.com/u/99159173?v=4&size=72" alt="Wcowin">
        </a>
      
      
      
    </nav>
  </span>

    
  </aside>

<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine feedback configuration -->

  


<!-- Determine whether to show feedback -->


<!-- Was this page helpful? -->

  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        此页面有帮助吗？
      </legend>
      <div class="md-feedback__inner">

        <!-- Feedback ratings -->
        <div class="md-feedback__list">
          
            <button
              class="md-feedback__icon md-icon"
              type="submit"
              title="This page was helpful"
              data-md-value="1"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg>
            </button>
          
            <button
              class="md-feedback__icon md-icon"
              type="submit"
              title="This page could be improved"
              data-md-value="0"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg>
            </button>
          
        </div>

        <!-- Feedback rating notes (shown after submission) -->
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              

              <!-- Determine title -->
              
                
              

              <!-- Replace {url} and {title} placeholders in note -->
              谢谢你的反馈！
            </div>
          
            <div data-md-value="0" hidden>
              

              <!-- Determine title -->
              
                
              

              <!-- Replace {url} and {title} placeholders in note -->
              Thanks for your feedback! Help us improve this page by using our <a href="https://marketingplatform.google.com/about/analytics/" target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <!-- 确保语言选择器不被翻译的样式 -->
<style>
  /* 确保语言选择器不被翻译 */
  .md-select,
  .md-header__option,
  .md-header__option *,
  [data-md-component="select"],
  [data-md-component="select"] *,
  .md-select__inner,
  .md-select__list,
  .md-select__item,
  .md-select__link,
  .md-header__button[for="__select"],
  .md-header__button[for="__select"] *,
  .md-header__source,
  .md-header__source * {
    translate: no !important;
  }
  
  /* 为语言选择器添加额外的保护 */
  [data-md-component="header"] .md-header__option,
  [data-md-component="header"] .md-select {
    translate: no !important;
  }
</style>

<!-- Footer -->
<footer class="md-footer">
  <!-- Link to previous and/or next page -->
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        <!-- Link to previous page -->
        
          
          <a href="../Mkdocs-AI-Summary/" class="md-footer__link md-footer__link--prev" aria-label="上一页: MkDocs文档AI摘要">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">上一页</span>
              <div class="md-ellipsis">MkDocs文档AI摘要</div>
            </div>
          </a>
        

        <!-- Link to next page -->
        
          
          <a href="../../../develop/regex/" class="md-footer__link md-footer__link--next" aria-label="下一页: 正则表达式基础">
            <div class="md-footer__title">
              <span class="md-footer__direction">下一页</span>
              <div class="md-ellipsis">正则表达式基础</div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  

  <!-- Footer content -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="footer-wrapper">
        <!-- Desktop layout -->
        <div class="footer-content">
          <div class="footer-visit-count">
            <div class="footer-item">
              <span>本站访问量：</span>
              <span id="finicount_views" class="footer-highlight">加载中...</span>
            </div>
            <div class="footer-item">
              <a href="https://icp.gov.moe/?keyword=20230640" target="_blank" rel="noopener" class="icp-link">萌ICP备20230640号</a>
            </div>
            <div class="footer-item runtime-info">
              <span>本站已经运行</span>
              <span id="box1" class="footer-highlight">计算中...</span>
            </div>
          </div>
        </div>

        <!-- Mobile layout -->
        <div class="footer-visit-count-mobile">
          <span>本站访问量：</span>
          <span id="finicount_views_mobile" class="footer-highlight">加载中...</span>
          |
          <a href="https://icp.gov.moe/?keyword=20230640" target="_blank" rel="noopener" class="icp-link">萌ICP备20230640号</a>
          <span class="runtime-info">
            <span>本站已经运行</span>
            <span id="box1_mobile" class="footer-highlight">计算中...</span>
          </span>
        </div>

        <!-- Copyright and social media -->
        <div class="footer-bottom-section">
          <div class="md-footer-copyright">
            <p>Copyright © 2022-2025 Wcowin</p>
            <p>Made with <a href="https://squidfunk.github.io/mkdocs-material/" class="mkdocs-link">Material for MkDocs</a></p>
          </div>
          
            <div class="footer-social">
              <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://pic1.zhimg.com/80/v2-8ad8e415b3eb139134b0373ff95c6846_1440w.webp" target="_blank" rel="noopener" title="pic1.zhimg.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://t.me/Wcowin" target="_blank" rel="noopener" title="t.me" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M256 8a248 248 0 1 0 0 496 248 248 0 1 0 0-496m115 168.7c-3.7 39.2-19.9 134.4-28.1 178.3-3.5 18.6-10.3 24.8-16.9 25.4-14.4 1.3-25.3-9.5-39.3-18.7-21.8-14.3-34.2-23.2-55.3-37.2-24.5-16.1-8.6-25 5.3-39.5 3.7-3.8 67.1-61.5 68.3-66.7.2-.7.3-3.1-1.2-4.4s-3.6-.8-5.1-.5c-2.2.5-37.1 23.5-104.6 69.1-9.9 6.8-18.9 10.1-26.9 9.9-8.9-.2-25.9-5-38.6-9.1-15.5-5-27.9-7.7-26.8-16.3.6-4.5 6.7-9 18.4-13.7 72.3-31.5 120.5-52.3 144.6-62.3 68.9-28.6 83.2-33.6 92.5-33.8 2.1 0 6.6.5 9.6 2.9 2 1.7 3.2 4.1 3.5 6.7.5 3.2.6 6.5.4 9.8z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://twitter.com/wcowin_" target="_blank" rel="noopener" title="Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/Wcowin" target="_blank" rel="noopener" title="Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://space.bilibili.com/1407028951/lists/4566631?type=series" target="_blank" rel="noopener" title="space.bilibili.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1-17.2 17-39.1 25.9-65.5 26.7H92c-26.4-.8-48.2-9.8-65.3-27.2S.7 396.5 0 368.2V169.8c.8-26 9.7-47.6 26.7-65.7C43.8 87.8 65.5 78.8 92 78h29.4L96 52.2c-5.7-5.7-8.6-13-8.6-21.8S90.3 14.3 96 8.6 109 0 117.9 0s16.1 2.9 21.9 8.6L213.1 78h88l74.5-69.4C381.7 2.9 389.2 0 398 0s16.1 2.9 21.9 8.6c5.7 5.7 8.6 13 8.6 21.8s-2.9 16.1-8.6 21.8L394.6 78h29.3c26.4.8 48 9.8 64.7 26.1m-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5-5.2-6.1-14-9.4-22.7-9.8H96c-9.6.4-17.4 3.7-23.6 9.8-6.1 6.1-9.4 13.9-9.8 23.5v194.4c0 9.2 3.3 17 9.8 23.5s14.4 9.8 23.6 9.8h320.4c9.2 0 17-3.3 23.3-9.8s9.7-14.3 10.1-23.5zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2-6.2 6.3-14 9.5-23.6 9.5s-17.5-3.2-23.6-9.5-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2s13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10m191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2s-14 9.5-23.6 9.5-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2s14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10"/></svg>
    </a>
  
    
    
    
    
    <a href="https://blog.csdn.net/m0_63203517?spm=1000.2115.3001.5343" target="_blank" rel="noopener" title="CSDN" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M0 64C0 28.7 28.7 0 64 0h149.5c17 0 33.3 6.7 45.3 18.7l106.5 106.6c12 12 18.7 28.3 18.7 45.3V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64zm208-5.5V152c0 13.3 10.7 24 24 24h93.5zm-53.8 237.1c8.6-10.1 7.5-25.2-2.6-33.8s-25.2-7.5-33.8 2.6l-48 56c-7.7 9-7.7 22.2 0 31.2l48 56c8.6 10.1 23.8 11.2 33.8 2.6s11.2-23.8 2.6-33.8L119.6 336zm112-31.2c-8.6-10.1-23.8-11.2-33.8-2.6s-11.2 23.8-2.6 33.8l34.6 40.4-34.6 40.4c-8.6 10.1-7.5 25.2 2.6 33.8s25.2 7.5 33.8-2.6l48-56c7.7-9 7.7-22.2 0-31.2z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<wangkewen821@gmail.com>" target="_blank" rel="noopener" title="Email" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M61.4 64C27.5 64 0 91.5 0 125.4c0 .9 0 1.7.1 2.6H0v256c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V128h-.1c0-.9.1-1.7.1-2.6 0-33.9-27.5-61.4-61.4-61.4zM464 192.3V384c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192.3l154.8 117.4c31.4 23.9 74.9 23.9 106.4 0zM48 125.4c0-7.4 6-13.4 13.4-13.4h389.2c7.4 0 13.4 6 13.4 13.4 0 4.2-2 8.2-5.3 10.7L280.2 271.5c-14.3 10.8-34.1 10.8-48.4 0L53.3 136.1c-3.3-2.5-5.3-6.5-5.3-10.7"/></svg>
    </a>
  
</div>
            </div>
          
        </div>
      </div>

      <!-- GLM-4-Flash 智能翻译系统 - 与MkDocs Alternate集成版 -->
      <script>
      (function() {
        'use strict';
        
        // 防止重复初始化
        if (window.glmTranslateInitialized) return;
        
        // GLM-4-Flash 配置 - 优化性能和稳定性
        const GLM_CONFIG = {
          endpoint: 'https://open.bigmodel.cn/api/paas/v4/chat/completions',
          model: 'glm-4-flash',
          maxRetries: 3,
          timeout: 8000,
          batchSize: 15,
          batchDelay: 50,
          maxConcurrent: 6,
          apiKey: '46ad7781e9fa44cb9b31d11a9696da89.GCUpkep25U5Y6vBg'
        };
        
        // 与MkDocs配置同步的语言映射
        const LANGUAGE_MAP = {
          'chinese_simplified': '中文',
          'english': 'English', 
          'korean': '한국어',
          'japanese': '日本語'
        };
        
        // 语言代码到ISO代码的映射 (用于MkDocs alternate)
        const LANG_TO_ISO = {
          'chinese_simplified': 'zh',
          'english': 'en',
          'korean': 'ko', 
          'japanese': 'ja'
        };
        
        // 专业术语词典 - 提升翻译质量
        const TECHNICAL_TERMS = {
          'chinese_simplified': {
            'API': 'API',
            'JavaScript': 'JavaScript',
            'TypeScript': 'TypeScript',
            'React': 'React',
            'Vue': 'Vue',
            'Node.js': 'Node.js',
            'GitHub': 'GitHub',
            'Docker': 'Docker',
            'Kubernetes': 'Kubernetes',
            'DevOps': 'DevOps',
            'CI/CD': 'CI/CD',
            'Material Design': 'Material Design',
            'MkDocs': 'MkDocs',
            'Markdown': 'Markdown',
            '人工智能': 'AI',
            '机器学习': 'Machine Learning',
            '深度学习': 'Deep Learning',
            '数据库': 'Database',
            '前端': 'Frontend',
            '后端': 'Backend',
            '全栈': 'Full Stack'
          },
          'english': {
            'API': 'API',
            'JavaScript': 'JavaScript',
            'TypeScript': 'TypeScript',
            'React': 'React',
            'Vue': 'Vue',
            'Node.js': 'Node.js',
            'GitHub': 'GitHub',
            'Docker': 'Docker',
            'Kubernetes': 'Kubernetes',
            'DevOps': 'DevOps',
            'CI/CD': 'CI/CD',
            'Material Design': 'Material Design',
            'MkDocs': 'MkDocs',
            'Markdown': 'Markdown',
            'AI': 'Artificial Intelligence',
            'Machine Learning': 'Machine Learning',
            'Deep Learning': 'Deep Learning',
            'Database': 'Database',
            'Frontend': 'Frontend',
            'Backend': 'Backend',
            'Full Stack': 'Full Stack'
          },
          'korean': {
            'API': 'API',
            'JavaScript': 'JavaScript',
            'TypeScript': 'TypeScript',
            'React': 'React',
            'Vue': 'Vue',
            'Node.js': 'Node.js',
            'GitHub': 'GitHub',
            'Docker': 'Docker',
            'Kubernetes': 'Kubernetes',
            'DevOps': 'DevOps',
            'CI/CD': 'CI/CD',
            'Material Design': 'Material Design',
            'MkDocs': 'MkDocs',
            'Markdown': 'Markdown',
            'AI': '인공지능',
            'Machine Learning': '머신러닝',
            'Deep Learning': '딥러닝',
            'Database': '데이터베이스',
            'Frontend': '프론트엔드',
            'Backend': '백엔드',
            'Full Stack': '풀스택'
          },
          'japanese': {
            'API': 'API',
            'JavaScript': 'JavaScript',
            'TypeScript': 'TypeScript',
            'React': 'React',
            'Vue': 'Vue',
            'Node.js': 'Node.js',
            'GitHub': 'GitHub',
            'Docker': 'Docker',
            'Kubernetes': 'Kubernetes',
            'DevOps': 'DevOps',
            'CI/CD': 'CI/CD',
            'Material Design': 'Material Design',
            'MkDocs': 'MkDocs',
            'Markdown': 'Markdown',
            'AI': '人工知能',
            'Machine Learning': '機械学習',
            'Deep Learning': 'ディープラーニング',
            'Database': 'データベース',
            'Frontend': 'フロントエンド',
            'Backend': 'バックエンド',
            'Full Stack': 'フルスタック'
          }
        };
        
        // DOM 操作优化工具类
        const DOMUtils = {
          // 缓存常用元素选择器
          cache: new Map(),
          
          // 优化的元素选择器
          select(selector, useCache = true) {
            if (useCache && this.cache.has(selector)) {
              const cached = this.cache.get(selector);
              if (document.contains(cached)) return cached;
              this.cache.delete(selector);
            }
            
            const element = document.querySelector(selector);
            if (useCache && element) {
              this.cache.set(selector, element);
            }
            return element;
          },
          
          // 批量选择元素
          selectAll(selector) {
            return document.querySelectorAll(selector);
          },
          
          // 创建元素并设置属性
          create(tag, attributes = {}, styles = {}) {
            const element = document.createElement(tag);
            
            Object.entries(attributes).forEach(([key, value]) => {
              if (key === 'textContent' || key === 'innerHTML') {
                element[key] = value;
              } else {
                element.setAttribute(key, value);
              }
            });
            
            Object.entries(styles).forEach(([key, value]) => {
              element.style[key] = value;
            });
            
            return element;
          },
          
          // 安全移除元素
          remove(element) {
            if (element && element.parentNode) {
              element.parentNode.removeChild(element);
            }
          },
          
          // 清理缓存
          clearCache() {
            this.cache.clear();
          }
        };
        
        // 响应式设计工具类
        const ResponsiveUtils = {
          breakpoints: {
            mobile: 768,
            small: 480
          },
          
          isMobile() {
            return window.innerWidth <= this.breakpoints.mobile;
          },
          
          isSmallScreen() {
            return window.innerWidth <= this.breakpoints.small;
          },
          
          getHeaderHeight() {
            const header = DOMUtils.select('.md-header');
            return header ? header.offsetHeight : 60;
          },
          
          calculateTopOffset(baseOffset = 20) {
            return this.getHeaderHeight() + baseOffset;
          }
        };
        
        // 事件管理工具类
        const EventManager = {
          listeners: new Map(),
          
          // 添加事件监听器并记录
          add(element, event, handler, options = {}) {
            const key = `${element.constructor.name}-${event}`;
            
            if (!this.listeners.has(key)) {
              this.listeners.set(key, []);
            }
            
            this.listeners.get(key).push({ element, handler, options });
            element.addEventListener(event, handler, options);
          },
          
          // 移除指定元素的所有事件监听器
          removeAll(element) {
            for (const [key, listeners] of this.listeners.entries()) {
              this.listeners.set(key, listeners.filter(listener => {
                if (listener.element === element) {
                  element.removeEventListener(key.split('-')[1], listener.handler, listener.options);
                  return false;
                }
                return true;
              }));
            }
          },
          
          // 清理所有事件监听器
          cleanup() {
            for (const [key, listeners] of this.listeners.entries()) {
              const eventType = key.split('-')[1];
              listeners.forEach(({ element, handler, options }) => {
                element.removeEventListener(eventType, handler, options);
              });
            }
            this.listeners.clear();
          }
        };
        
        // 性能优化工具类
        const PerformanceUtils = {
          // 防抖函数
          debounce(func, wait, immediate) {
            let timeout;
            return function executedFunction(...args) {
              const later = () => {
                timeout = null;
                if (!immediate) func(...args);
              };
              const callNow = immediate && !timeout;
              clearTimeout(timeout);
              timeout = setTimeout(later, wait);
              if (callNow) func(...args);
            };
          },
          
          // 节流函数
          throttle(func, limit) {
            let inThrottle;
            return function(...args) {
              if (!inThrottle) {
                func.apply(this, args);
                inThrottle = true;
                setTimeout(() => inThrottle = false, limit);
              }
            };
          },
          
          // 批量操作
          batch(operations) {
            requestAnimationFrame(() => {
              operations.forEach(op => op());
            });
          }
        };

        // 全局状态管理
        let currentLanguage = 'chinese_simplified';
        let originalTexts = new Map();
        let translationCache = new Map();
        let isTranslating = false;
        let activeRequests = 0;
        let lastUrl = window.location.href;
        let pageTranslationStates = new Map();
        let globalTranslationPreference = null;
        let navigationDialogShown = false; // 防止导航弹窗重复显示
        
        // 翻译中断控制
        let translationAbortController = null;
        let shouldCancelTranslation = false;
        
        // 翻译中断函数 - 返回Promise确保中断完成
        function cancelCurrentTranslation(reason = '用户取消') {
          return new Promise((resolve) => {
            console.log(`🛑 中断翻译: ${reason}`);
            
            // 设置中断标志
            shouldCancelTranslation = true;
            
            // 中断AbortController
            if (translationAbortController) {
              translationAbortController.abort();
              translationAbortController = null;
            }
            
            // 中断Web Workers
            if (TranslationWorkerManager && TranslationWorkerManager.workers) {
              TranslationWorkerManager.workers.forEach(({ worker }) => {
                try {
                  worker.terminate();
                } catch (e) {
                  console.warn('中断Worker失败:', e);
                }
              });
              // 重新初始化Workers
              setTimeout(() => {
                try {
                  TranslationWorkerManager.init();
                } catch (e) {
                  console.warn('重新初始化Workers失败:', e);
                }
              }, 100);
            }
            
            // 如果是因为用户切换到中文而中断，立即恢复原文
            if (reason.includes('用户切换到中文') || reason.includes('用户手动中断')) {
              console.log('🔄 中断时立即恢复原文');
              
              // 尝试使用原始文本映射恢复
              if (originalTexts.size > 0) {
                let restoredCount = 0;
                originalTexts.forEach((originalText, node) => {
                  if (node && node.parentNode && originalText && document.contains(node)) {
                    try {
                      node.textContent = originalText;
                      // 清理翻译标记
                      node.removeAttribute('data-translated');
                      node.removeAttribute('data-original-text');
                      node.removeAttribute('data-target-lang');
                      restoredCount++;
                    } catch (e) {
                      console.warn('恢复单个节点失败:', e);
                    }
                  }
                });
                console.log(`✅ 中断时恢复了 ${restoredCount}/${originalTexts.size} 个文本节点`);
              }
              
              // 清理所有剩余的翻译标记
              const translatedElements = document.querySelectorAll('[data-translated]');
              if (translatedElements.length > 0) {
                let cleanedCount = 0;
                translatedElements.forEach(element => {
                  try {
                    const originalText = element.getAttribute('data-original-text');
                    if (originalText) {
                      element.textContent = originalText;
                      cleanedCount++;
                    }
                    element.removeAttribute('data-translated');
                    element.removeAttribute('data-original-text');
                    element.removeAttribute('data-target-lang');
                  } catch (e) {
                    console.warn('清理单个元素失败:', e);
                  }
                });
                console.log(`🧹 中断时清理了 ${cleanedCount} 个翻译标记`);
              }
            }
            
            // 清除状态显示
            const existingStatus = document.getElementById('translate-status');
            if (existingStatus) {
              existingStatus.remove();
            }
            
            // 重置翻译状态
            isTranslating = false;
            activeRequests = 0;
            
            console.log('✅ 翻译已中断');
            
            // 确保状态重置完成后再继续
            setTimeout(resolve, 50);
          });
        }
        let contextCache = new Map();
        let semanticCache = new Map();
        
        // 翻译质量分析器
        const TranslationQualityAnalyzer = {
          // 计算文本相似度
          calculateSimilarity: function(text1, text2) {
            const words1 = text1.toLowerCase().split(/\s+/);
            const words2 = text2.toLowerCase().split(/\s+/);
            const allWords = new Set([...words1, ...words2]);
            
            let matches = 0;
            for (const word of allWords) {
              if (words1.includes(word) && words2.includes(word)) {
                matches++;
              }
            }
            
            return matches / allWords.size;
          },
          
          // 检查是否存在语义相似的翻译
          findSimilarTranslation: function(text, targetLang) {
            const cacheKey = `${targetLang}_semantic`;
            if (!semanticCache.has(cacheKey)) {
              return null;
            }
            
            const similarTranslations = semanticCache.get(cacheKey);
            for (const [originalText, translatedText] of similarTranslations) {
              const similarity = this.calculateSimilarity(text, originalText);
              if (similarity > 0.8) { // 80%相似度阈值
                console.log(`🔄 找到语义相似翻译 (相似度: ${(similarity * 100).toFixed(1)}%):`, originalText, '->', translatedText);
                return translatedText;
              }
            }
            
            return null;
          },
          
          // 保存语义翻译
          saveSimilarTranslation: function(originalText, translatedText, targetLang) {
            const cacheKey = `${targetLang}_semantic`;
            if (!semanticCache.has(cacheKey)) {
              semanticCache.set(cacheKey, new Map());
            }
            
            const similarTranslations = semanticCache.get(cacheKey);
            similarTranslations.set(originalText, translatedText);
            
            // 限制语义缓存大小
            if (similarTranslations.size > 500) {
              const entries = Array.from(similarTranslations.entries());
              similarTranslations.clear();
              entries.slice(-400).forEach(([key, value]) => {
                similarTranslations.set(key, value);
              });
            }
          },
          
          // 专业术语替换
          replaceTechnicalTerms: function(text, sourceLang, targetLang) {
            if (!TECHNICAL_TERMS[sourceLang] || !TECHNICAL_TERMS[targetLang]) {
              return text;
            }
            
            let processedText = text;
            const sourceTerms = TECHNICAL_TERMS[sourceLang];
            const targetTerms = TECHNICAL_TERMS[targetLang];
            
            // 替换专业术语
            for (const [sourceTerm, standardTerm] of Object.entries(sourceTerms)) {
              if (targetTerms[standardTerm]) {
                const regex = new RegExp(`\\b${sourceTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'gi');
                processedText = processedText.replace(regex, targetTerms[standardTerm]);
              }
            }
            
            return processedText;
          }
        };
        
        // 精确的忽略选择器 - 防止翻译界面元素
        const IGNORE_SELECTORS = [
          '.footer-highlight', '.md-footer-copyright', '.hljs', 'code', 'pre',
          'script', 'style', '[data-no-translate]', '.icp-link', '.runtime-info',
          // MkDocs界面元素
          '.md-header__option', '.md-select', '.md-select__inner', '.md-select__list',
          '.md-select__item', '.md-select__link', '.md-header__button[for="__select"]',
          '.md-header__source', '[data-md-component="palette"]', '[data-md-component="search"]',
          '[data-md-component="select"]', '[data-md-component="header"] .md-header__option',
          '.md-header__title', '[data-md-component="source"]', '.md-source',
          // 页脚专用选择器
          '.footer-visit-count', '.footer-visit-count-mobile', '.footer-social',
          '#finicount_views', '#finicount_views_mobile', '#box1', '#box1_mobile'
        ];
        
        // 智能缓存管理
        const CACHE_MAX_SIZE = 2000;
        const CACHE_MAX_AGE = 14 * 24 * 60 * 60 * 1000; // 14天过期
        const STORAGE_PREFIX = 'glm_translate_';
        
        // 初始化持久化缓存
        function initPersistentCache() {
          try {
            console.log('🚀 初始化GLM翻译缓存系统...');
            
            // 加载翻译缓存
            const cached = localStorage.getItem(STORAGE_PREFIX + 'cache');
            if (cached) {
              try {
                const parsedCache = JSON.parse(cached);
                if (parsedCache && typeof parsedCache === 'object') {
                  const now = Date.now();
                  
                  Object.entries(parsedCache).forEach(([key, value]) => {
                    if (key && typeof key === 'string') {
                      if (typeof value === 'object' && value.timestamp && value.text) {
                        if (now - value.timestamp < CACHE_MAX_AGE) {
                          translationCache.set(key, value.text);
                        }
                      } else if (typeof value === 'string') {
                        translationCache.set(key, value);
                      }
                    }
                  });
                  console.log(`📦 已加载 ${translationCache.size} 条翻译缓存`);
                }
              } catch (e) {
                console.warn('缓存解析失败:', e);
                localStorage.removeItem(STORAGE_PREFIX + 'cache');
              }
            }
            
            // 恢复全局翻译偏好
            const savedPreference = localStorage.getItem(STORAGE_PREFIX + 'preference');
            if (savedPreference) {
              try {
                let preference = savedPreference;
                if (savedPreference.startsWith('"') && savedPreference.endsWith('"')) {
                  preference = JSON.parse(savedPreference);
                }
                
                if (preference && typeof preference === 'string' && LANGUAGE_MAP[preference]) {
                  globalTranslationPreference = preference;
                  console.log(`🌐 已加载全局翻译偏好: ${LANGUAGE_MAP[preference]}`);
                } else {
                  localStorage.removeItem(STORAGE_PREFIX + 'preference');
                }
              } catch (e) {
                console.warn('全局偏好解析失败:', e);
                localStorage.removeItem(STORAGE_PREFIX + 'preference');
              }
            }
            
            // 恢复页面翻译状态
            const savedStates = localStorage.getItem(STORAGE_PREFIX + 'states');
            if (savedStates) {
              try {
                const states = JSON.parse(savedStates);
                if (states && typeof states === 'object') {
                  const now = Date.now();
                  let validStatesCount = 0;
                  
                  Object.entries(states).forEach(([url, state]) => {
                    if (url && state && typeof url === 'string' && 
                        state.language && state.timestamp && 
                        LANGUAGE_MAP[state.language]) {
                      if (now - state.timestamp < CACHE_MAX_AGE) {
                        pageTranslationStates.set(url, state);
                        validStatesCount++;
                      }
                    }
                  });
                  
                  console.log(`📄 已加载 ${validStatesCount} 个页面翻译状态`);
                  
                  if (validStatesCount === 0 && Object.keys(states).length > 0) {
                    localStorage.removeItem(STORAGE_PREFIX + 'states');
                  }
                }
              } catch (e) {
                console.warn('页面状态解析失败:', e);
                localStorage.removeItem(STORAGE_PREFIX + 'states');
              }
            }
            
          } catch (error) {
            console.warn('缓存初始化失败:', error);
            translationCache.clear();
            pageTranslationStates.clear();
            globalTranslationPreference = null;
            try {
              [STORAGE_PREFIX + 'cache', STORAGE_PREFIX + 'preference', STORAGE_PREFIX + 'states'].forEach(key => {
                localStorage.removeItem(key);
              });
            } catch (e) {
              console.warn('清理缓存失败:', e);
            }
          }
        }
        
        // 保存持久化缓存
        function savePersistentCache() {
          try {
            if (translationCache.size > CACHE_MAX_SIZE) {
              const entries = Array.from(translationCache.entries());
              translationCache.clear();
              const keepCount = Math.floor(CACHE_MAX_SIZE * 0.8);
              entries.slice(-keepCount).forEach(([key, value]) => {
                translationCache.set(key, value);
              });
              console.log(`🧹 缓存已清理，保留 ${translationCache.size} 条记录`);
            }
            
            // 保存翻译缓存
            if (translationCache.size > 0) {
              const cacheObj = {};
              const now = Date.now();
              translationCache.forEach((value, key) => {
                if (key && value && typeof key === 'string' && typeof value === 'string') {
                  cacheObj[key] = { text: value, timestamp: now };
                }
              });
              
              if (Object.keys(cacheObj).length > 0) {
                localStorage.setItem(STORAGE_PREFIX + 'cache', JSON.stringify(cacheObj));
              }
            } else {
              localStorage.removeItem(STORAGE_PREFIX + 'cache');
            }
            
            // 保存全局翻译偏好
            if (globalTranslationPreference && LANGUAGE_MAP[globalTranslationPreference]) {
              localStorage.setItem(STORAGE_PREFIX + 'preference', JSON.stringify(globalTranslationPreference));
            } else {
              localStorage.removeItem(STORAGE_PREFIX + 'preference');
            }
            
            // 保存页面翻译状态
            if (pageTranslationStates.size > 0) {
              const statesData = {};
              const now = Date.now();
              
              pageTranslationStates.forEach((state, url) => {
                if (url && state && typeof url === 'string' && 
                    state.language && LANGUAGE_MAP[state.language] &&
                    now - state.timestamp < CACHE_MAX_AGE) {
                  statesData[url] = state;
                }
              });
              
              if (Object.keys(statesData).length > 0) {
                localStorage.setItem(STORAGE_PREFIX + 'states', JSON.stringify(statesData));
              } else {
                localStorage.removeItem(STORAGE_PREFIX + 'states');
              }
            } else {
              localStorage.removeItem(STORAGE_PREFIX + 'states');
            }
            
          } catch (error) {
            if (error.name === 'QuotaExceededError') {
              console.warn('存储空间不足，执行清理操作');
              try {
                translationCache.clear();
                localStorage.removeItem(STORAGE_PREFIX + 'cache');
                
                const now = Date.now();
                const validStates = new Map();
                pageTranslationStates.forEach((state, url) => {
                  if (now - state.timestamp < CACHE_MAX_AGE / 2) {
                    validStates.set(url, state);
                  }
                });
                pageTranslationStates.clear();
                validStates.forEach((state, url) => pageTranslationStates.set(url, state));
                
                if (pageTranslationStates.size > 0) {
                  const statesData = Object.fromEntries(pageTranslationStates);
                  localStorage.setItem(STORAGE_PREFIX + 'states', JSON.stringify(statesData));
                } else {
                  localStorage.removeItem(STORAGE_PREFIX + 'states');
                }
                
                console.log('✅ 存储空间清理完成');
              } catch (cleanupError) {
                console.warn('清理操作失败:', cleanupError);
              }
            } else {
              console.warn('缓存保存失败:', error);
            }
          }
        }
        
        // 智能文本检测 - 提升翻译精度，减少失败
        function shouldTranslateText(text) {
          if (!text || text.length < 2 || text.length > 800) return false;
          
          // 快速跳过明显不需要翻译的内容
          if (/^[\d\s\-_.,!?()\[\]{}:;"'`~#$%^&*+=|\\\/<>]+$/.test(text)) return false;
          
          // 跳过URL、邮箱、日期格式
          if (/^https?:\/\/|@.*\.|\d{4}-\d{2}-\d{2}|\d{1,2}[:\/]\d{1,2}/.test(text)) return false;
          
          // 跳过版本号和技术标识符
          if (/^v?\d+\.\d+(\.\d+)?(-\w+)?$/.test(text)) return false;
          if (/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(text) && text.length < 30) return false;
          if (/^[A-Z_][A-Z0-9_]*$/.test(text)) return false; // 常量名
          
          // 跳过常见技术术语和编程标识符
          const technicalTerms = [
            'GitHub', 'API', 'JSON', 'HTML', 'CSS', 'JavaScript', 'Python', 'Material', 'MkDocs',
            'React', 'Vue', 'Docker', 'npm', 'yarn', 'webpack', 'TypeScript', 'Markdown',
            'Git', 'Linux', 'Windows', 'macOS', 'iOS', 'Android', 'Chrome', 'Firefox',
            'UTF-8', 'HTTP', 'HTTPS', 'URL', 'SEO', 'RSS', 'XML', 'YAML', 'OK', 'ERROR'
          ];
          
          if (technicalTerms.includes(text.trim())) return false;
          
          // 跳过纯英文单词（可能是已经翻译的内容或专业术语）
          if (/^[a-zA-Z\s]+$/.test(text) && text.split(/\s+/).every(word => 
            word.length < 20 && !/[\u4e00-\u9fff]/.test(word)
          )) {
            // 但保留明显的中式英文或需要翻译的短语
            const commonChineseEnglish = ['Hello', 'Welcome', 'About', 'Contact', 'Home', 'Blog'];
            if (!commonChineseEnglish.some(term => text.includes(term)) && text.length < 50) {
              return false;
            }
          }
          
          // 跳过纯数字和符号组合
          if (/^[\d\s\-+*/=().,]+$/.test(text)) return false;
          
          // 跳过文件路径和代码片段
          if (/^[\w\-/.]+\.(js|css|html|py|md|txt|json|yml|yaml)$/i.test(text)) return false;
          if (/^import\s|^from\s|^class\s|^function\s|^const\s|^let\s|^var\s/.test(text)) return false;
          
          // 检查是否包含中文字符（主要翻译目标）
          const hasChinese = /[\u4e00-\u9fff]/.test(text);
          
          // 包含中文的内容优先翻译
          if (hasChinese) return true;
          
          // 英文内容的进一步筛选
          if (/^[a-zA-Z\s\-'.,!?]+$/.test(text)) {
            // 跳过过短的英文（可能是标签或按钮）
            if (text.length < 6) return false;
            
            // 保留包含多个单词的有意义句子
            const words = text.trim().split(/\s+/);
            if (words.length >= 3 && text.length >= 10) return true;
            
            // 跳过其他英文内容
            return false;
          }
          
          return true;
        }
        
        // 翻译质量验证和清理 - 增强版
        function validateAndCleanTranslation(originalText, translatedText, targetLang) {
          let cleanedText = translatedText
            .replace(/^["'`]+|["'`]+$/g, '')
            .replace(/\n+/g, ' ')
            .replace(/^\s+|\s+$/g, '')
            .trim();
          
          if (!cleanedText || cleanedText.trim() === '') {
            console.warn('❌ 翻译结果为空');
            return originalText;
          }
          
          // 长度合理性检查 - 更严格
          const lengthRatio = cleanedText.length / originalText.length;
          if (lengthRatio > 12 || lengthRatio < 0.05) {
            console.warn(`❌ 翻译长度异常: 原文${originalText.length}字符, 译文${cleanedText.length}字符, 比例${lengthRatio.toFixed(2)}`);
            return originalText;
          }
          
          // 检查是否包含明显的错误标记
          const errorPatterns = [
            /\[翻译错误\]/i, /\[ERROR\]/i, /\[TRANSLATION[_\s]ERROR\]/i,
            /^(Sorry|抱歉|无法翻译|Cannot translate)/i,
            /^(I cannot|I'm unable|Unable to)/i,
            /^(作为AI|作为语言模型|As an AI)/i,
            /\[注：/, /\[Note:/i, /\[提示：/i,
            /^(Translation|翻译)[:：]/i,
            /^(Here is|这是)/i
          ];
          
          for (const pattern of errorPatterns) {
            if (pattern.test(cleanedText)) {
              console.warn('❌ 检测到翻译错误标记，返回原文');
              return originalText;
            }
          }
          
          // 检查是否包含过多原文内容
          if (originalText.length > 10) {
            const originalWords = originalText.toLowerCase().split(/\s+/);
            const translatedWords = cleanedText.toLowerCase().split(/\s+/);
            let commonWords = 0;
            
            originalWords.forEach(word => {
              if (word.length > 2 && translatedWords.includes(word)) {
                commonWords++;
              }
            });
            
            const commonRatio = commonWords / Math.max(originalWords.length, 1);
            if (commonRatio > 0.7 && cleanedText.length < originalText.length * 1.3) {
              console.warn(`❌ 翻译包含过多原文内容 (${(commonRatio * 100).toFixed(1)}%)`);
              return originalText;
            }
          }
          
          // 特定语言的质量检查
          if (targetLang === 'english') {
            // 检查英文翻译质量
            if (!/[a-zA-Z]/.test(cleanedText)) {
              console.warn('❌ 英文翻译不包含英文字符');
              return originalText;
            }
            
            // 检查是否还包含大量中文字符
            const chineseChars = (cleanedText.match(/[\u4e00-\u9fff]/g) || []).length;
            if (chineseChars > cleanedText.length * 0.3) {
              console.warn('❌ 英文翻译包含过多中文字符');
              return originalText;
            }
          } else if (targetLang === 'korean') {
            // 检查韩文翻译质量
            if (!/[ㄱ-ㅎ가-힣]/.test(cleanedText)) {
              console.warn('❌ 韩文翻译不包含韩文字符');
              return originalText;
            }
          } else if (targetLang === 'japanese') {
            // 检查日文翻译质量
            if (!/[ひらがなカタカナ一-龯]/.test(cleanedText)) {
              console.warn('❌ 日文翻译不包含日文字符');
              return originalText;
            }
          }
          
          // 检查翻译是否合理 - 避免过于简单的重复
          if (cleanedText.length < 3 && originalText.length > 10) {
            console.warn('❌ 翻译结果过于简短');
            return originalText;
          }
          
          // 最终验证通过
          console.log(`✅ 翻译质量验证通过: "${originalText.substring(0, 30)}..." -> "${cleanedText.substring(0, 30)}..."`);
          return cleanedText;
        }
        
        // 高质量GLM翻译函数 - 增强版（支持中断）
        async function translateWithGLM(text, targetLang, context = null) {
          // 参数验证
          if (!text || typeof text !== 'string' || text.trim().length === 0) {
            console.warn('❌ 翻译文本为空或无效');
            return text || '';
          }
          
          if (!targetLang || !LANGUAGE_MAP[targetLang]) {
            console.warn(`❌ 目标语言无效: ${targetLang}`);
            return text;
          }
          
          // 检查是否应该中断
          if (shouldCancelTranslation || translationAbortController?.signal?.aborted) {
            console.log('🛑 翻译请求被中断');
            return text;
          }
          
          // 首先检查标准缓存
          const cacheKey = `${text.trim()}_${targetLang}`;
          if (translationCache.has(cacheKey)) {
            return translationCache.get(cacheKey);
          }
          
          // 检查语义相似翻译
          const similarTranslation = TranslationQualityAnalyzer.findSimilarTranslation(text, targetLang);
          if (similarTranslation) {
            translationCache.set(cacheKey, similarTranslation);
            return similarTranslation;
          }
          
          if (!shouldTranslateText(text)) {
            translationCache.set(cacheKey, text);
            return text;
          }
          
          // 专业术语预处理
          const processedText = TranslationQualityAnalyzer.replaceTechnicalTerms(text, 'chinese_simplified', targetLang);
          if (processedText !== text) {
            console.log(`🔧 专业术语替换: "${text}" -> "${processedText}"`);
            translationCache.set(cacheKey, processedText);
            return processedText;
          }
          
          while (activeRequests >= GLM_CONFIG.maxConcurrent) {
            // 在等待时也检查中断
            if (shouldCancelTranslation || translationAbortController?.signal?.aborted) {
              console.log('🛑 等待期间翻译被中断');
              return text;
            }
            await new Promise(resolve => setTimeout(resolve, 10));
          }
          
          activeRequests++;
          
          const targetLanguage = LANGUAGE_MAP[targetLang] || targetLang;
          const textLength = text.length;
          
          // 构建上下文感知的提示词
          let prompt;
          let contextInfo = '';
          
          if (context && context.previousText) {
            contextInfo = `\n上下文：前文提到"${context.previousText}"`;
          }
          
          if (targetLang === 'english') {
            prompt = textLength < 30 
              ? `Translate to natural English: "${text}"`
              : `Translate this Chinese text to natural, fluent English. Consider the context and maintain consistency with technical terms.${contextInfo}\n\nText to translate: ${text}`;
          } else if (targetLang === 'korean') {
            prompt = textLength < 30
              ? `자연스러운 한국어로 번역: "${text}"`
              : `다음 중국어 텍스트를 자연스럽고 유창한 한국어로 번역해주세요. 맥락을 고려하고 전문 용어의 일관성을 유지해주세요.${contextInfo}\n\n번역할 텍스트: ${text}`;
          } else if (targetLang === 'japanese') {
            prompt = textLength < 30
              ? `自然な日本語に翻訳: "${text}"`
              : `以下の中国語テキストを自然で流暢な日本語に翻訳してください。文脈を考慮し、専門用語の一貫性を保ってください。${contextInfo}\n\n翻訳するテキスト：${text}`;
          } else {
            prompt = `请将以下中文翻译为自然流畅的${targetLanguage}。考虑上下文，保持专业术语的一致性。${contextInfo}\n\n待翻译文本：${text}`;
          }
          
          // 智能重试机制（支持中断）
          for (let attempt = 0; attempt < GLM_CONFIG.maxRetries; attempt++) {
            try {
              // 检查中断
              if (shouldCancelTranslation || translationAbortController?.signal?.aborted) {
                console.log('🛑 翻译重试过程中被中断');
                activeRequests--;
                return text;
              }
              
              // 使用全局中断控制器，如果存在的话
              const controller = translationAbortController || new AbortController();
              const timeoutId = setTimeout(() => controller.abort(), GLM_CONFIG.timeout);
              
              const requestBody = {
                model: GLM_CONFIG.model,
                messages: [{ role: 'user', content: prompt }],
                temperature: 0.1,
                max_tokens: Math.min(Math.max(textLength * 2, 50), 500),
                top_p: 0.95,
                frequency_penalty: 0.0,
                presence_penalty: 0.0,
                stream: false
              };
              
              const response = await fetch(GLM_CONFIG.endpoint, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${GLM_CONFIG.apiKey}`
                },
                body: JSON.stringify(requestBody),
                signal: controller.signal
              });
              
              clearTimeout(timeoutId);
              
              if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`API error ${response.status}: ${errorText}`);
              }
              
              const data = await response.json();
              const translatedText = data.choices?.[0]?.message?.content?.trim();
              
              if (translatedText) {
                const cleanedText = validateAndCleanTranslation(text, translatedText, targetLang);
                
                if (cleanedText && cleanedText !== text) {
                  // 保存到标准缓存
                  translationCache.set(cacheKey, cleanedText);
                  
                  // 保存到语义缓存
                  TranslationQualityAnalyzer.saveSimilarTranslation(text, cleanedText, targetLang);
                  
                  if (translationCache.size % 100 === 0) {
                    setTimeout(savePersistentCache, 1000);
                  }
                  
                  activeRequests--;
                  return cleanedText;
                }
              }
              
              throw new Error('空翻译结果');
              
            } catch (error) {
              // 如果是中断错误，直接返回
              if (error.name === 'AbortError' || shouldCancelTranslation) {
                console.log('🛑 翻译API请求被中断');
                activeRequests--;
                return text;
              }
              
              console.warn(`翻译尝试 ${attempt + 1}/${GLM_CONFIG.maxRetries} 失败:`, error.message);
              
              if (attempt === GLM_CONFIG.maxRetries - 1) {
                activeRequests--;
                return text;
              }
              
              await new Promise(resolve => setTimeout(resolve, 500 * Math.pow(2, attempt)));
            }
          }
          
          activeRequests--;
          return text;
        }
        
        // Web Worker 翻译管理器
        const TranslationWorkerManager = {
          workers: [],
          taskQueue: [],
          maxWorkers: Math.min(navigator.hardwareConcurrency || 4, 4),
          workerScript: null,
          
          // 初始化 Worker
          init: function() {
            if (this.workers.length > 0) return;
            
            // 创建 Worker 脚本
            const workerCode = `
              let translationCache = new Map();
              let activeRequests = 0;
              const maxConcurrent = 2;
              
              const GLM_CONFIG = {
                endpoint: 'https://open.bigmodel.cn/api/paas/v4/chat/completions',
                model: 'glm-4-flash',
                maxRetries: 3,
                timeout: 8000,
                apiKey: '46ad7781e9fa44cb9b31d11a9696da89.GCUpkep25U5Y6vBg'
              };
              
              async function translateText(text, targetLang, context) {
                const cacheKey = \`\${text}_\${targetLang}\`;
                if (translationCache.has(cacheKey)) {
                  return translationCache.get(cacheKey);
                }
                
                while (activeRequests >= maxConcurrent) {
                  await new Promise(resolve => setTimeout(resolve, 10));
                }
                
                activeRequests++;
                
                try {
                  const controller = new AbortController();
                  const timeoutId = setTimeout(() => controller.abort(), GLM_CONFIG.timeout);
                  
                  let prompt;
                  const targetLanguageMap = {
                    'english': 'English',
                    'korean': '한국어',
                    'japanese': '日本語'
                  };
                  
                  const targetLanguage = targetLanguageMap[targetLang] || targetLang;
                  let contextInfo = context ? \`\\n上下文：前文提到"\${context}"\` : '';
                  
                  if (targetLang === 'english') {
                    prompt = \`Translate this Chinese text to natural, fluent English. Consider the context and maintain consistency.\${contextInfo}\\n\\nText: \${text}\`;
                  } else if (targetLang === 'korean') {
                    prompt = \`다음 중국어 텍스트를 자연스럽고 유창한 한국어로 번역해주세요.\${contextInfo}\\n\\n텍스트: \${text}\`;
                  } else if (targetLang === 'japanese') {
                    prompt = \`以下の中国語テキストを自然で流暢な日本語に翻訳してください。\${contextInfo}\\n\\nテキスト：\${text}\`;
                  }
                  
                  const response = await fetch(GLM_CONFIG.endpoint, {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                      'Authorization': \`Bearer \${GLM_CONFIG.apiKey}\`
                    },
                    body: JSON.stringify({
                      model: GLM_CONFIG.model,
                      messages: [{ role: 'user', content: prompt }],
                      temperature: 0.1,
                      max_tokens: Math.min(Math.max(text.length * 2, 50), 500),
                      top_p: 0.95
                    }),
                    signal: controller.signal
                  });
                  
                  clearTimeout(timeoutId);
                  
                  if (response.ok) {
                    const data = await response.json();
                    const translated = data.choices?.[0]?.message?.content?.trim();
                    if (translated) {
                      translationCache.set(cacheKey, translated);
                      return translated;
                    }
                  }
                  
                  return text;
                } catch (error) {
                  return text;
                } finally {
                  activeRequests--;
                }
              }
              
              self.onmessage = async function(e) {
                const { id, text, targetLang, context } = e.data;
                try {
                  const result = await translateText(text, targetLang, context);
                  self.postMessage({ id, success: true, result });
                } catch (error) {
                  self.postMessage({ id, success: false, error: error.message, result: text });
                }
              };
            `;
            
            this.workerScript = new Blob([workerCode], { type: 'application/javascript' });
            
            // 创建 Workers
            for (let i = 0; i < this.maxWorkers; i++) {
              try {
                const workerUrl = URL.createObjectURL(this.workerScript);
                const worker = new Worker(workerUrl);
                worker.onmessage = (e) => this.handleWorkerMessage(e);
                worker.onerror = (error) => console.warn('Worker 错误:', error);
                this.workers.push({
                  worker,
                  workerUrl, // 保存URL引用以便清理
                  busy: false,
                  taskId: null
                });
              } catch (error) {
                console.warn('创建 Worker 失败:', error);
                break;
              }
            }
            
            console.log(`🚀 创建了 ${this.workers.length} 个翻译 Workers`);
          },
          
          // 处理 Worker 消息
          handleWorkerMessage: function(e) {
            const { id, success, result, error } = e.data;
            const task = this.taskQueue.find(t => t.id === id);
            
            if (task) {
              // 标记 Worker 为空闲
              const workerInfo = this.workers.find(w => w.taskId === id);
              if (workerInfo) {
                workerInfo.busy = false;
                workerInfo.taskId = null;
              }
              
              // 移除任务
              const taskIndex = this.taskQueue.findIndex(t => t.id === id);
              if (taskIndex > -1) {
                this.taskQueue.splice(taskIndex, 1);
              }
              
              // 执行回调
              if (success) {
                task.resolve(result);
              } else {
                console.warn('Worker 翻译失败:', error);
                task.resolve(result || task.text); // 失败时返回原文
              }
              
              // 处理队列中的下一个任务
              this.processQueue();
            }
          },
          
          // 处理任务队列
          processQueue: function() {
            const pendingTasks = this.taskQueue.filter(t => !t.assigned);
            const availableWorkers = this.workers.filter(w => !w.busy);
            
            const tasksToProcess = Math.min(pendingTasks.length, availableWorkers.length);
            
            for (let i = 0; i < tasksToProcess; i++) {
              const task = pendingTasks[i];
              const workerInfo = availableWorkers[i];
              
              task.assigned = true;
              workerInfo.busy = true;
              workerInfo.taskId = task.id;
              
              workerInfo.worker.postMessage({
                id: task.id,
                text: task.text,
                targetLang: task.targetLang,
                context: task.context
              });
            }
          },
          
          // 翻译任务
          translate: function(text, targetLang, context = null) {
            return new Promise((resolve) => {
              if (this.workers.length === 0) {
                // 如果没有 Workers，回退到主线程
                translateWithGLM(text, targetLang, context ? { previousText: context } : null)
                  .then(resolve)
                  .catch(() => resolve(text));
                return;
              }
              
              const taskId = Date.now() + Math.random();
              
              this.taskQueue.push({
                id: taskId,
                text,
                targetLang,
                context,
                resolve,
                assigned: false
              });
              
              this.processQueue();
            });
          },
          
          // 销毁 Workers
          destroy: function() {
            this.workers.forEach(({ worker, workerUrl }) => {
              try {
                worker.terminate();
              } catch (e) {
                console.warn('销毁Worker失败:', e);
              }
              
              // 清理Worker URL
              if (workerUrl) {
                try {
                  URL.revokeObjectURL(workerUrl);
                } catch (e) {
                  console.warn('清理Worker URL失败:', e);
                }
              }
            });
            this.workers = [];
            this.taskQueue = [];
            
            // 清理脚本Blob
            if (this.workerScript) {
              this.workerScript = null;
            }
            
            console.log('🧹 Web Workers 已清理');
          }
        };
        
        // 虚拟滚动翻译优化器
        const VirtualScrollOptimizer = {
          visibleElements: new Set(),
          observer: null,
          pendingTranslations: new Map(),
          
          // 初始化虚拟滚动
          init: function() {
            if (this.observer) return;
            
            this.observer = new IntersectionObserver((entries) => {
              entries.forEach(entry => {
                const element = entry.target;
                
                if (entry.isIntersecting) {
                  // 元素进入视口
                  this.visibleElements.add(element);
                  
                  // 检查是否有待处理的翻译
                  if (this.pendingTranslations.has(element)) {
                    const { text, targetLang, context } = this.pendingTranslations.get(element);
                    this.performTranslation(element, text, targetLang, context);
                    this.pendingTranslations.delete(element);
                  }
                } else {
                  // 元素离开视口
                  this.visibleElements.delete(element);
                }
              });
            }, {
              rootMargin: '100px', // 提前100px开始加载
              threshold: 0.1
            });
            
            console.log('📱 虚拟滚动优化器已初始化');
          },
          
          // 观察元素
          observe: function(element) {
            if (this.observer && element) {
              this.observer.observe(element);
            }
          },
          
          // 取消观察
          unobserve: function(element) {
            if (this.observer && element) {
              this.observer.unobserve(element);
              this.visibleElements.delete(element);
              this.pendingTranslations.delete(element);
            }
          },
          
          // 调度翻译（优先处理可见元素）
          scheduleTranslation: function(element, text, targetLang, context = null) {
            if (this.visibleElements.has(element)) {
              // 可见元素立即翻译
              return this.performTranslation(element, text, targetLang, context);
            } else {
              // 不可见元素延迟翻译
              this.pendingTranslations.set(element, { text, targetLang, context });
              return Promise.resolve(text);
            }
          },
          
          // 执行翻译
          performTranslation: async function(element, text, targetLang, context) {
            try {
              const result = await TranslationWorkerManager.translate(text, targetLang, context);
              
              // 检查元素是否仍然存在且可见
              if (element.isConnected && this.visibleElements.has(element)) {
                element.textContent = result;
                element.setAttribute('data-translated', 'true');
                element.setAttribute('data-original-text', text);
              }
              
              return result;
            } catch (error) {
              console.warn('虚拟滚动翻译失败:', error);
              return text;
            }
          },
          
          // 销毁
          destroy: function() {
            if (this.observer) {
              this.observer.disconnect();
              this.observer = null;
            }
            this.visibleElements.clear();
            this.pendingTranslations.clear();
          }
        };
        
        // 元素忽略检查
        function shouldIgnoreElement(element) {
          if (!element || !element.tagName) return true;
          
          const tagName = element.tagName.toLowerCase();
          if (['script', 'style', 'noscript', 'iframe', 'svg', 'canvas'].includes(tagName)) {
            return true;
          }
          
          for (const selector of IGNORE_SELECTORS) {
            try {
              if (element.matches(selector)) return true;
            } catch (e) {}
          }
          
          if (element.hasAttribute('data-no-translate') || 
              element.hasAttribute('data-translated') ||
              element.contentEditable === 'true') {
            return true;
          }
          
          return false;
        }
        
        // 获取可翻译文本节点
        function getTextNodes(element) {
          const textNodes = [];
          
          const walker = document.createTreeWalker(
            element,
            NodeFilter.SHOW_TEXT,
            {
              acceptNode: (node) => {
                const text = node.textContent.trim();
                
                if (!text || text.length < 2) {
                  return NodeFilter.FILTER_REJECT;
                }
                
                if (shouldIgnoreElement(node.parentElement)) {
                  return NodeFilter.FILTER_REJECT;
                }
                
                if (!shouldTranslateText(text)) {
                  return NodeFilter.FILTER_REJECT;
                }
                
                return NodeFilter.FILTER_ACCEPT;
              }
            }
          );
          
          let node;
          while (node = walker.nextNode()) {
            const nodeData = { 
              node, 
              text: node.textContent.trim(),
              priority: getTranslationPriority(node)
            };
            textNodes.push(nodeData);
          }
          
          // 按优先级排序，优先翻译正文内容
          textNodes.sort((a, b) => b.priority - a.priority);
          
          return textNodes;
        }
        
        // 获取翻译优先级 - 正文内容优先
        function getTranslationPriority(node) {
          let element = node.parentElement;
          let priority = 0;
          
          while (element) {
            // 正文内容区域 - 最高优先级
            if (element.matches('.md-content__inner, .md-typeset, article, main, [role="main"]')) {
              priority += 100;
            }
            
            // 标题优先级
            if (element.matches('h1, h2, h3, h4, h5, h6')) {
              priority += 80;
            }
            
            // 段落内容
            if (element.matches('p, li, td, th, blockquote, pre code')) {
              priority += 60;
            }
            
            // 重要文本元素
            if (element.matches('strong, em, b, i, mark')) {
              priority += 40;
            }
            
            // 链接和按钮
            if (element.matches('a, button, .md-button')) {
              priority += 30;
            }
            
            // 导航和菜单 - 中等优先级
            if (element.matches('.md-nav, .md-tabs, .md-header')) {
              priority += 20;
            }
            
            // 其他UI元素 - 低优先级
            if (element.matches('.md-footer, .md-sidebar, .md-search')) {
              priority += 10;
            }
            
            element = element.parentElement;
          }
          
          // 根据文本长度调整优先级（长文本优先）
          const textLength = node.textContent.trim().length;
          if (textLength > 100) {
            priority += 20;
          } else if (textLength > 50) {
            priority += 10;
          } else if (textLength > 20) {
            priority += 5;
          }
          
          return priority;
        }
        
        // 获取内容类型描述
        function getContentTypeDescription(node) {
          let element = node.parentElement;
          
          while (element) {
            // 正文内容
            if (element.matches('.md-content__inner, .md-typeset, article, main, [role="main"]')) {
              if (element.matches('h1, h2, h3, h4, h5, h6')) return '标题';
              if (element.matches('p')) return '正文段落';
              if (element.matches('li')) return '列表内容';
              if (element.matches('blockquote')) return '引用内容';
              if (element.matches('td, th')) return '表格内容';
              return '正文内容';
            }
            
            // 导航元素
            if (element.matches('.md-nav')) return '导航菜单';
            if (element.matches('.md-tabs')) return '标签页';
            if (element.matches('.md-header')) return '页面头部';
            
            // 其他UI元素
            if (element.matches('.md-footer')) return '页脚内容';
            if (element.matches('.md-sidebar')) return '侧边栏';
            if (element.matches('button, .md-button')) return '按钮';
            if (element.matches('a')) return '链接';
            
            element = element.parentElement;
          }
          
          return '页面内容';
        }
        
        // 显示翻译状态 - 支持多语言通知和进度可视化
        function showTranslateStatus(message, duration = 0, forceLanguage = null, progress = null) {
          // 获取通知文本的多语言版本
          const getLocalizedMessage = (msg, lang) => {
            const translations = {
              'chinese_simplified': {
                '不支持的语言': '不支持的语言',
                '翻译进行中，请稍候': '翻译进行中，请稍候',
                '页面无需翻译': '页面无需翻译',
                '没有找到需要翻译的内容': '没有找到需要翻译的内容',
                '翻译失败，请重试': '翻译失败，请重试',
                '已恢复中文': '已恢复中文',
                '已清除所有翻译设置': '已清除所有翻译设置',  
                '已恢复当前页面，其他页面保持翻译状态': '已恢复当前页面，其他页面保持翻译状态',
                '缓存已清除，重置为中文': '缓存已清除，重置为中文',
                '清除缓存失败': '清除缓存失败'
              },
              'english': {
                '不支持的语言': 'Unsupported language',
                '翻译进行中，请稍候': 'Translation in progress, please wait',
                '页面无需翻译': 'Page does not need translation',
                '没有找到需要翻译的内容': 'No content found for translation',
                '翻译失败，请重试': 'Translation failed, please try again',
                '已恢复中文': 'Restored to Chinese',
                '已清除所有翻译设置': 'All translation settings cleared',
                '已恢复当前页面，其他页面保持翻译状态': 'Current page restored, other pages keep translation',
                '缓存已清除，重置为中文': 'Cache cleared, reset to Chinese',
                '清除缓存失败': 'Failed to clear cache'
              },
              'korean': {
                '不支持的语言': '지원되지 않는 언어',
                '翻译进行中，请稍候': '번역 진행 중, 잠시 기다려주세요',
                '页面无需翻译': '페이지에 번역이 필요하지 않습니다',
                '没有找到需要翻译的内容': '번역할 내용을 찾을 수 없습니다',
                '翻译失败，请重试': '번역 실패, 다시 시도해주세요',
                '已恢复中文': '중국어로 복원됨',
                '已清除所有翻译设置': '모든 번역 설정이 지워졌습니다',
                '已恢复当前页面，其他页面保持翻译状态': '현재 페이지 복원, 다른 페이지는 번역 상태 유지',
                '缓存已清除，重置为中文': '캐시 지워짐, 중국어로 재설정',
                '清除缓存失败': '캐시 지우기 실패'
              },
              'japanese': {
                '不支持的语言': 'サポートされていない言語',
                '翻译进行中，请稍候': '翻訳中です、お待ちください',
                '页面无需翻译': 'ページは翻訳する必要がありません',
                '没有找到需要翻译的内容': '翻訳するコンテンツが見つかりません',
                '翻译失败，请重试': '翻訳に失敗しました、再試行してください',
                '已恢复中文': '中国語に復元されました',
                '已清除所有翻译设置': 'すべての翻訳設定をクリアしました',
                '已恢复当前页面，其他页面保持翻译状态': '現在のページを復元、他のページは翻訳状態を維持',
                '缓存已清除，重置为中文': 'キャッシュをクリア、中国語にリセット',
                '清除缓存失败': 'キャッシュのクリアに失敗'
              }
            };
            
            const langTranslations = translations[lang] || translations['chinese_simplified'];
            
            // 处理动态消息（包含变量的消息）
            if (msg.includes('翻译中...') || msg.includes('Translation...') || msg.includes('번역 중...') || msg.includes('翻訳中...')) {
              // 保持进度消息的原样，因为它们包含动态内容
              return msg;
            }
            
            if (msg.includes('翻译完成') || msg.includes('Translation completed') || msg.includes('번역 완료') || msg.includes('翻訳完了')) {
              // 保持完成消息的原样，因为它们包含统计信息
              return msg;
            }
            
            if (msg.includes('✅') && lang !== 'chinese_simplified') {
              // 处理包含目标语言名称的消息
              if (lang === 'english' && msg.includes('English')) return msg;
              if (lang === 'korean' && msg.includes('한국어')) return msg;
              if (lang === 'japanese' && msg.includes('日本語')) return msg;
            }
            
            // 查找完全匹配的翻译
            for (const [key, value] of Object.entries(langTranslations)) {
              if (msg === key) {
                return value;
              }
            }
            
            return msg; // 如果没有找到翻译，返回原文
          };
          
          // 确定使用的语言
          const displayLanguage = forceLanguage || currentLanguage || 'chinese_simplified';
          const localizedMessage = getLocalizedMessage(message, displayLanguage);
          
          let statusEl = document.getElementById('translate-status');
          
          // 如果已有状态元素，先移除避免冲突
          if (statusEl) {
            statusEl.remove();
            statusEl = null;
          }
          
          // 创建新的状态元素
          if (!statusEl) {
            statusEl = document.createElement('div');
            statusEl.id = 'translate-status';
            statusEl.style.cssText = `
              position: fixed;
              bottom: 20px;
              right: 20px;
              background: rgba(32, 33, 36, 0.95);
              color: #ffffff;
              padding: 12px 16px;
              border-radius: 8px;
              font-size: 13px;
              font-weight: 500;
              z-index: 10000;
              transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
              backdrop-filter: blur(12px);
              border: 1px solid rgba(255, 255, 255, 0.1);
              box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
              min-width: 180px;
              max-width: 320px;
              will-change: transform, opacity;
              user-select: none;
              -webkit-user-select: none;
              -webkit-tap-highlight-color: transparent;
              line-height: 1.4;
            `;
            
            // 添加移动端响应式样式
            const isMobile = window.innerWidth <= 768;
            const isSmallScreen = window.innerWidth <= 480;
            
            if (isMobile) {
              const mobileStyles = `
                bottom: ${isSmallScreen ? '15px' : '20px'};
                right: ${isSmallScreen ? '10px' : '15px'};
                left: ${isSmallScreen ? '10px' : 'auto'};
                max-width: ${isSmallScreen ? 'calc(100vw - 20px)' : '280px'};
                min-width: auto;
                padding: ${isSmallScreen ? '10px 12px' : '12px 14px'};
                font-size: ${isSmallScreen ? '12px' : '13px'};
                border-radius: 6px;
              `;
              statusEl.style.cssText += mobileStyles;
            }
            document.body.appendChild(statusEl);
            
            // 添加窗口大小变化监听器
            const updatePosition = () => {
              const isMobile = window.innerWidth <= 768;
              const isSmallScreen = window.innerWidth <= 480;
              
              if (isMobile) {
                statusEl.style.bottom = isSmallScreen ? '15px' : '20px';
                statusEl.style.right = isSmallScreen ? '10px' : '15px';
                statusEl.style.left = isSmallScreen ? '10px' : 'auto';
                statusEl.style.maxWidth = isSmallScreen ? 'calc(100vw - 20px)' : '280px';
                statusEl.style.minWidth = 'auto';
                statusEl.style.padding = isSmallScreen ? '10px 12px' : '12px 14px';
                statusEl.style.fontSize = isSmallScreen ? '12px' : '13px';
                statusEl.style.borderRadius = '6px';
              } else {
                statusEl.style.bottom = '20px';
                statusEl.style.right = '20px';
                statusEl.style.left = 'auto';
                statusEl.style.maxWidth = '320px';
                statusEl.style.minWidth = '180px';
                statusEl.style.padding = '12px 16px';
                statusEl.style.fontSize = '13px';
                statusEl.style.borderRadius = '8px';
              }
            };
            
            // 绑定窗口大小变化事件和屏幕方向变化事件
            window.addEventListener('resize', updatePosition);
            window.addEventListener('orientationchange', () => {
              // 延迟执行以确保屏幕方向变化完成
              setTimeout(updatePosition, 100);
            });
            
            // 存储清理函数以供后续移除
            statusEl._cleanupResize = () => {
              window.removeEventListener('resize', updatePosition);
              window.removeEventListener('orientationchange', updatePosition);
            };
          }
          
          // 创建状态内容 - 简洁版本
          let statusContent = `<div style="display: flex; align-items: center; gap: 8px;">`;
          
          // 添加简洁图标
          if (message.includes('翻译中') || message.includes('Translation') || message.includes('번역') || message.includes('翻訳')) {
            statusContent += `<div class="translate-spinner" style="
              width: 16px;
              height: 16px;
              border: 2px solid rgba(255, 255, 255, 0.3);
              border-top: 2px solid #ffffff;
              border-radius: 50%;
              animation: translateSpin 1s linear infinite;
              flex-shrink: 0;
            "></div>`;
          } else if (message.includes('✅') || message.includes('完成') || message.includes('成功')) {
            statusContent += `<span style="font-size: 14px; flex-shrink: 0;">✅</span>`;
          } else if (message.includes('❌') || message.includes('失败') || message.includes('错误')) {
            statusContent += `<span style="font-size: 14px; flex-shrink: 0;">❌</span>`;
          } else {
            statusContent += `<span style="font-size: 14px; flex-shrink: 0;">🌍</span>`;
          }
          
          statusContent += `<div style="flex: 1; min-width: 0;">
            <div style="
              white-space: nowrap;
              overflow: hidden;
              text-overflow: ellipsis;
            ">${localizedMessage}</div>`;
          
          // 添加简化进度条（仅在进行中时显示）
          if (progress !== null && progress.current && progress.total && (message.includes('翻译中') || message.includes('Translation') || message.includes('번역') || message.includes('翻訳'))) {
            const percentage = Math.round((progress.current / progress.total) * 100);
            statusContent += `
              <div style="
                width: 100%;
                height: 2px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 1px;
                overflow: hidden;
                margin-top: 6px;
              ">
                <div style="
                  width: ${percentage}%;
                  height: 100%;
                  background: #4CAF50;
                  transition: width 0.3s ease;
                "></div>
              </div>
              <div style="
                font-size: 10px;
                color: rgba(255, 255, 255, 0.7);
                margin-top: 2px;
              ">${percentage}%</div>`;
          }
          
          statusContent += `</div></div>`;
          
          statusEl.innerHTML = statusContent;
          statusEl.style.opacity = '1';
          statusEl.style.transform = 'translateY(0)';
          
          // 添加动画样式
          if (!document.getElementById('translate-status-styles')) {
            const style = document.createElement('style');
            style.id = 'translate-status-styles';
            style.textContent = `
              @keyframes translateSpin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
              }
            `;
            document.head.appendChild(style);
          }
          
          if (duration > 0) {
            setTimeout(() => {
              statusEl.style.opacity = '0';
              statusEl.style.transform = 'translateY(-10px)';
              setTimeout(() => {
                if (statusEl.parentNode) {
                  // 清理resize监听器
                  if (statusEl._cleanupResize) {
                    statusEl._cleanupResize();
                  }
                  statusEl.parentNode.removeChild(statusEl);
                }
              }, 300);
            }, duration);
          }
        }
        
        // 快捷键管理器
        const ShortcutManager = {
          shortcuts: new Map(),
          isInitialized: false,
          
          // 初始化快捷键
          init: function() {
            if (this.isInitialized) return;
            
            // 定义快捷键
            this.shortcuts.set('Ctrl+Shift+T', () => this.showTranslationMenu());
            this.shortcuts.set('Ctrl+Shift+E', () => window.translateTo('english'));
            this.shortcuts.set('Ctrl+Shift+K', () => window.translateTo('korean'));
            this.shortcuts.set('Ctrl+Shift+J', () => window.translateTo('japanese'));
            this.shortcuts.set('Ctrl+Shift+C', () => window.translateTo('chinese_simplified'));
            this.shortcuts.set('Ctrl+Shift+R', () => window.clearTranslateCache());
            this.shortcuts.set('Ctrl+Shift+X', async () => {
              if (isTranslating) {
                await cancelCurrentTranslation('用户手动中断');
                showTranslateStatus('翻译已中断', 2000);
              }
            });
            this.shortcuts.set('Escape', () => this.hideTranslationMenu());
            
            // 监听键盘事件
            document.addEventListener('keydown', (e) => this.handleKeydown(e));
            
            this.isInitialized = true;
            console.log('⌨️ 翻译快捷键已初始化');
            console.log('快捷键列表：');
            console.log('- Ctrl+Shift+T: 显示翻译菜单');
            console.log('- Ctrl+Shift+E: 翻译为English');
            console.log('- Ctrl+Shift+K: 翻译为한국어');
            console.log('- Ctrl+Shift+J: 翻译为日本語');
            console.log('- Ctrl+Shift+C: 恢复中文');
            console.log('- Ctrl+Shift+R: 清除翻译缓存');
            console.log('- Ctrl+Shift+X: 中断当前翻译');
          },
          
          // 处理键盘事件
          handleKeydown: function(e) {
            // 忽略在输入框中的按键
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
              return;
            }
            
            const key = this.getKeyString(e);
            const handler = this.shortcuts.get(key);
            
            if (handler) {
              e.preventDefault();
              e.stopPropagation();
              handler();
            }
          },
          
          // 获取按键字符串
          getKeyString: function(e) {
            const parts = [];
            
            if (e.ctrlKey) parts.push('Ctrl');
            if (e.shiftKey) parts.push('Shift');
            if (e.altKey) parts.push('Alt');
            if (e.metaKey) parts.push('Meta');
            
            if (e.key && e.key !== 'Control' && e.key !== 'Shift' && e.key !== 'Alt' && e.key !== 'Meta') {
              parts.push(e.key);
            }
            
            return parts.join('+');
          },
          
          // 显示翻译菜单
          showTranslationMenu: function() {
            let menu = document.getElementById('translation-shortcut-menu');
            
            if (menu) {
              menu.remove();
            }
            
            menu = document.createElement('div');
            menu.id = 'translation-shortcut-menu';
            menu.style.cssText = `
              position: fixed;
              top: 100%;
              left: 50%;
              transform: translate(-50%, -50%);
              background: rgba(0, 0, 0, 0.95);
              color: white;
              border-radius: 16px;
              padding: 24px;
              font-size: 14px;
              z-index: 10001;
              backdrop-filter: blur(20px);
              border: 1px solid rgba(255, 255, 255, 0.2);
              box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
              min-width: 300px;
              animation: menuFadeIn 0.3s ease-out;
            `;
            
            // 添加动画样式
            if (!document.getElementById('shortcut-menu-styles')) {
              const style = document.createElement('style');
              style.id = 'shortcut-menu-styles';
              style.textContent = `
                @keyframes menuFadeIn {
                  from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                  to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                }
                .menu-item {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  padding: 12px 16px;
                  border-radius: 8px;
                  cursor: pointer;
                  transition: all 0.2s ease;
                  margin: 4px 0;
                }
                .menu-item:hover {
                  background: rgba(255, 255, 255, 0.1);
                  transform: translateX(4px);
                }
                .menu-shortcut {
                  font-family: monospace;
                  background: rgba(255, 255, 255, 0.1);
                  padding: 4px 8px;
                  border-radius: 4px;
                  font-size: 12px;
                }
              `;
              document.head.appendChild(style);
            }
            
            const currentLang = window.getCurrentLanguageName();
            
            menu.innerHTML = `
              <div style="text-align: center; margin-bottom: 20px;">
                <h3 style="margin: 0 0 8px 0; font-size: 18px; font-weight: 700;">🌍 翻译快捷菜单</h3>
                <p style="margin: 0; color: rgba(255, 255, 255, 0.7); font-size: 12px;">当前语言: ${currentLang}</p>
              </div>
              
              <div class="menu-item" onclick="window.translateTo('english'); this.parentElement.remove();">
                <span>🇺🇸 翻译为 English</span>
                <span class="menu-shortcut">Ctrl+Shift+E</span>
              </div>
              
              <div class="menu-item" onclick="window.translateTo('korean'); this.parentElement.remove();">
                <span>🇰🇷 翻译为 한국어</span>
                <span class="menu-shortcut">Ctrl+Shift+K</span>
              </div>
              
              <div class="menu-item" onclick="window.translateTo('japanese'); this.parentElement.remove();">
                <span>🇯🇵 翻译为 日本語</span>
                <span class="menu-shortcut">Ctrl+Shift+J</span>
              </div>
              
              <div class="menu-item" onclick="window.translateTo('chinese_simplified'); this.parentElement.remove();">
                <span>🇨🇳 恢复中文</span>
                <span class="menu-shortcut">Ctrl+Shift+C</span>
              </div>
              
              <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); margin: 12px 0; padding-top: 12px;">
                ${isTranslating ? `
                <div class="menu-item" onclick="(async () => { await cancelCurrentTranslation('用户手动中断'); showTranslateStatus('翻译已中断', 2000); this.parentElement.parentElement.remove(); })();">
                  <span>⏹️ 中断当前翻译</span>
                  <span class="menu-shortcut">Ctrl+Shift+X</span>
                </div>
                ` : ''}
                <div class="menu-item" onclick="window.clearTranslateCache(); this.parentElement.parentElement.remove();">
                  <span>🗑️ 清除翻译缓存</span>
                  <span class="menu-shortcut">Ctrl+Shift+R</span>
                </div>
              </div>
              
              <div style="text-align: center; margin-top: 16px;">
                <div style="font-size: 12px; color: rgba(255, 255, 255, 0.5);">
                  按 ESC 关闭菜单
                </div>
              </div>
            `;
            
            document.body.appendChild(menu);
            
            // 点击外部关闭
            setTimeout(() => {
              const closeOnClickOutside = (e) => {
                if (!menu.contains(e.target)) {
                  menu.remove();
                  document.removeEventListener('click', closeOnClickOutside);
                }
              };
              document.addEventListener('click', closeOnClickOutside);
            }, 100);
          },
          
          // 隐藏翻译菜单
          hideTranslationMenu: function() {
            const menu = document.getElementById('translation-shortcut-menu');
            if (menu) {
              menu.remove();
            }
          }
        };
        
        // 获取当前页面标识
        function getCurrentPageKey() {
          const url = new URL(window.location.href);
          return url.pathname + url.search;
        }
        
        // 保存当前页面状态
        function saveCurrentPageState() {
          const pageKey = getCurrentPageKey();
          
          // 保持现有的explicit标记（如果存在）
          const existingState = pageTranslationStates.get(pageKey);
          const newState = {
            language: currentLanguage,
            timestamp: Date.now(),
            url: window.location.href
          };
          
          // 如果之前有explicit标记，保留它
          if (existingState && existingState.explicit) {
            newState.explicit = true;
          }
          
          pageTranslationStates.set(pageKey, newState);
          savePersistentCache();
        }
        
        // 页面翻译主函数 - 支持中断的增强版
        async function translatePage(targetLang, isAutoTranslate = false) {
          // 如果正在翻译且用户主动切换到中文，立即中断当前翻译
          if (isTranslating && targetLang === 'chinese_simplified' && !isAutoTranslate) {
            console.log('🛑 用户切换到中文，中断当前翻译');
            await cancelCurrentTranslation('用户切换到中文');
          }
          
          // 如果正在翻译且不是自动翻译，根据情况处理
          if (isTranslating && !isAutoTranslate) {
            if (targetLang === 'chinese_simplified') {
              // 已经在上面处理了中断
            } else {
              console.log('🔄 中断并切换翻译语言');
              await cancelCurrentTranslation('切换翻译语言');
            }
          } else if (isTranslating && isAutoTranslate) {
            console.log('⏸️ 翻译进行中，跳过自动翻译请求');
            return;
          }
          
          if (!targetLang || !LANGUAGE_MAP[targetLang]) {
            console.warn(`❌ 不支持的语言: ${targetLang}`);
            showTranslateStatus('不支持的语言', 2000);
            return;
          }
          
          // 重置中断标志
          shouldCancelTranslation = false;
          isTranslating = true;
          
          // 创建新的AbortController
          translationAbortController = new AbortController();
          
          console.log(`🎯 开始翻译页面: ${LANGUAGE_MAP[currentLanguage]} -> ${LANGUAGE_MAP[targetLang]}`);
          
          try {
            // 不在这里显示初始翻译状态，因为后面会有详细的进度显示
            
            if (targetLang === 'chinese_simplified') {
              // 恢复中文 - 始终恢复到原始中文状态
              console.log('🔄 恢复中文状态');
              
              // 优先使用原始文本映射恢复
              if (originalTexts.size > 0) {
                let restoredCount = 0;
                originalTexts.forEach((originalText, node) => {
                  if (node && node.parentNode && originalText) {
                    try {
                      node.textContent = originalText;
                      restoredCount++;
                    } catch (e) {
                      console.warn('恢复单个节点失败:', e);
                    }
                  }
                });
                console.log(`✅ 已恢复 ${restoredCount}/${originalTexts.size} 个文本节点`);
              }
              
              // 清理所有翻译标记 - 作为备用恢复机制
              const translatedElements = document.querySelectorAll('[data-translated]');
              if (translatedElements.length > 0) {
                let cleanedCount = 0;
                translatedElements.forEach(element => {
                  try {
                    const originalText = element.getAttribute('data-original-text');
                    if (originalText) {
                      element.textContent = originalText;
                      cleanedCount++;
                    }
                    element.removeAttribute('data-translated');
                    element.removeAttribute('data-original-text');
                  } catch (e) {
                    console.warn('清理单个元素失败:', e);
                  }
                });
                console.log(`🧹 清理了 ${cleanedCount} 个翻译标记`);
              }
              
              currentLanguage = targetLang;
              
              // 保留originalTexts用于后续翻译
              console.log(`📝 保留 ${originalTexts.size} 个原始文本映射供后续使用`);
              
              saveCurrentPageState();
              
              // 清除任何正在显示的状态
              const existingStatus = document.getElementById('translate-status');
              if (existingStatus) {
                existingStatus.remove();
              }
              
              showTranslateStatus('已恢复中文', 2000);
              return;
            }
            
            // 翻译到其他语言
            console.log('🌍 开始翻译到其他语言');
            
            // 智能状态检查和重置
            if (currentLanguage !== 'chinese_simplified') {
              console.log('🔄 先恢复中文状态以获取正确的原始文本');
              
              // 恢复中文
              if (originalTexts.size > 0) {
                let restoredCount = 0;
                originalTexts.forEach((originalText, node) => {
                  if (node && node.parentNode && originalText) {
                    try {
                      node.textContent = originalText;
                      restoredCount++;
                    } catch (e) {
                      console.warn('恢复单个节点失败:', e);
                    }
                  }
                });
                console.log(`✅ 恢复了 ${restoredCount} 个文本节点`);
              }
              
              // 清理翻译标记
              const translatedElements = document.querySelectorAll('[data-translated]');
              if (translatedElements.length > 0) {
                translatedElements.forEach(element => {
                  try {
                    const originalText = element.getAttribute('data-original-text');
                    if (originalText) {
                      element.textContent = originalText;
                    }
                    element.removeAttribute('data-translated');
                    element.removeAttribute('data-original-text');
                  } catch (e) {
                    console.warn('清理单个元素失败:', e);
                  }
                });
              }
              
              currentLanguage = 'chinese_simplified';
              
              // 等待DOM更新
              await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            // 获取当前页面的文本节点
            const textNodeData = getTextNodes(document.body);
            
            // 确保在翻译开始前建立完整的原始文本映射
            console.log('📝 确保原始文本映射完整建立');
            
            // 为所有可翻译的文本节点建立映射，确保中断时能正确恢复
            let mappingUpdated = false;
            textNodeData.forEach(({ node, text, priority }) => {
              if (text && text.length > 1 && text.trim()) {
                if (!originalTexts.has(node)) {
                  // 获取节点的当前原始文本（未翻译状态）
                  const currentText = node.textContent.trim();
                  if (currentText && currentText === text) {
                    originalTexts.set(node, text);
                    mappingUpdated = true;
                  }
                }
              }
            });
            
            if (mappingUpdated) {
              console.log(`📝 原始文本映射已完善，总计 ${originalTexts.size} 个节点`);
            } else {
              console.log(`📝 原始文本映射已存在，总计 ${originalTexts.size} 个节点`);
            }
            
            // 准备翻译的文本 - 使用优先级排序和原始文本确保质量
            const textsToTranslate = [];
            textNodeData.forEach(({ node, text, priority }) => {
              if (text && text.length > 1 && text.trim()) {
                // 优先使用映射中的原始文本，确保翻译质量
                const originalText = originalTexts.get(node) || text;
                textsToTranslate.push({ node, text: originalText, priority });
              }
            });
            
            // textsToTranslate 已经通过 getTextNodes 按优先级排序
            
            if (textsToTranslate.length === 0) {
              console.log('⚠️ 没有找到需要翻译的内容');
              showTranslateStatus('没有找到需要翻译的内容', 2000);
              currentLanguage = targetLang;
              return;
            }
            
            console.log(`📊 找到 ${textsToTranslate.length} 个文本节点需要翻译`);
            let translatedCount = 0;
            let skippedCount = 0;
            let failedCount = 0;
            
            // 增强的分批翻译处理 - 支持中断检查
            for (let i = 0; i < textsToTranslate.length; i += GLM_CONFIG.batchSize) {
              // 检查是否应该中断翻译
              if (shouldCancelTranslation || translationAbortController?.signal?.aborted) {
                console.log('🛑 翻译被中断，停止处理');
                return;
              }
              
              const batch = textsToTranslate.slice(i, i + GLM_CONFIG.batchSize);
              
              // 获取当前批次的主要内容类型
              const contentTypes = batch.map(({ node }) => getContentTypeDescription(node));
              const mainContentType = contentTypes.find(type => type.includes('正文')) || 
                                     contentTypes.find(type => type.includes('标题')) || 
                                     contentTypes[0] || '页面内容';
              
              const promises = batch.map(async ({ node, text, priority }) => {
                try {
                  // 增强的节点有效性检查
                  if (!node || !node.parentNode || !node.isConnected || !document.contains(node)) {
                    console.warn('⚠️ 节点已失效，跳过翻译');
                    skippedCount++;
                    return { success: false, reason: 'invalid_node' };
                  }
                  
                  // 增强的文本有效性检查
                  if (!text || !text.trim() || text.length < 2) {
                    skippedCount++;
                    return { success: false, reason: 'invalid_text' };
                  }
                  
                  // 检查是否应该跳过翻译
                  if (!shouldTranslateText(text)) {
                    skippedCount++;
                    return { success: false, reason: 'should_not_translate' };
                  }
                  
                  console.log(`🔄 翻译文本: "${text.substring(0, 50)}${text.length > 50 ? '...' : ''}"`);
                  
                  const translatedText = await translateWithGLM(text, targetLang);
                  
                  // 增强的翻译结果验证
                  if (translatedText && translatedText.trim() && translatedText !== text) {
                    // 验证翻译质量
                    const cleanedTranslation = validateAndCleanTranslation(text, translatedText, targetLang);
                    
                    if (cleanedTranslation !== text && node.isConnected && node.parentNode) {
                      // 双重检查节点状态，确保安全更新
                      try {
                        node.textContent = cleanedTranslation;
                        node.setAttribute('data-translated', 'true');
                        node.setAttribute('data-original-text', text);
                        node.setAttribute('data-target-lang', targetLang);
                        translatedCount++;
                        return { success: true, original: text, translated: cleanedTranslation };
                      } catch (updateError) {
                        console.warn('❌ 更新节点内容失败:', updateError);
                        skippedCount++; // 改为跳过，因为这通常是DOM变化导致的
                        return { success: false, reason: 'update_failed', error: updateError };
                      }
                    } else if (cleanedTranslation === text) {
                      console.log('⚪ 翻译结果与原文相同，可能无需翻译');
                      skippedCount++;
                      return { success: false, reason: 'same_as_original' };
                    } else {
                      console.warn('❌ 节点状态异常，跳过更新');
                      skippedCount++; // 改为跳过，因为这通常是DOM状态问题
                      return { success: false, reason: 'node_state_invalid' };
                    }
                  } else {
                    // 翻译结果无效 - 这可能是因为内容不需要翻译
                    console.log('⚪ 翻译结果无效或与原文相同，跳过');
                    skippedCount++;
                    return { success: false, reason: 'invalid_translation_result' };
                  }
                } catch (error) {
                  // 区分不同类型的错误
                  if (error.name === 'AbortError' || shouldCancelTranslation) {
                    console.log('🛑 翻译被中断');
                    return { success: false, reason: 'translation_cancelled' };
                  } else if (error.message && error.message.includes('API')) {
                    console.warn('⚠️ API调用失败:', error.message);
                    failedCount++;
                    return { success: false, reason: 'api_error', error: error };
                  } else {
                    console.warn('⚠️ 翻译异常，跳过该项:', error.message || error);
                    skippedCount++; // 大多数异常改为跳过而不是失败
                    return { success: false, reason: 'translation_skipped', error: error };
                  }
                }
              });
              
              // 等待批次完成并收集结果
              const batchResults = await Promise.allSettled(promises);
              
              // 分析批次结果
              const successfulResults = batchResults.filter(result => 
                result.status === 'fulfilled' && result.value?.success
              );
              
              const failedResults = batchResults.filter(result => 
                result.status === 'rejected' || (result.status === 'fulfilled' && !result.value?.success)
              );
              
              if (failedResults.length > 0) {
                const failureReasons = failedResults.map(result => {
                  if (result.status === 'rejected') {
                    return `promise_rejected: ${result.reason}`;
                  } else {
                    return result.value?.reason || 'unknown';
                  }
                });
                console.log(`⚠️ 批次 ${Math.floor(i / GLM_CONFIG.batchSize) + 1} 失败统计:`, failureReasons);
              }
              
              // 更新进度 - 优化统计信息显示
              const progress = Math.round(((i + GLM_CONFIG.batchSize) / textsToTranslate.length) * 100);
              const currentProgress = Math.min(progress, 100);
              
              // 计算成功率和详细统计
              const totalProcessed = translatedCount + skippedCount + failedCount;
              const successRate = totalProcessed > 0 ? Math.round((translatedCount / totalProcessed) * 100) : 0;
              
              // 优化的状态消息 - 包含内容类型
              let statusMessage = `翻译${mainContentType} ${currentProgress}%`;
              
              if (totalProcessed > 0) {
                if (translatedCount > 0) {
                  statusMessage += ` (✅${translatedCount}`;
                  if (skippedCount > 0) statusMessage += ` ⏭️${skippedCount}`;
                  if (failedCount > 0) statusMessage += ` ❌${failedCount}`;
                  statusMessage += `)`;
                } else if (skippedCount > 0 && failedCount === 0) {
                  // 翻译进行中时，不要显示"内容已是目标语言"，而是显示处理状态
                  statusMessage += ` (稍等片刻...)`;
                } else if (failedCount > 0) {
                  statusMessage += ` (处理中...)`;
                } else {
                  statusMessage += ` (准备中...)`;
                }
              }
              
              // 显示带进度条的状态（设置较短的显示时间，避免与完成消息冲突）
              const progressInfo = {
                current: Math.min(i + GLM_CONFIG.batchSize, textsToTranslate.length),
                total: textsToTranslate.length
              };
              
              // 如果不是最后一批，显示进度；如果是最后一批，不显示避免与完成消息冲突
              if (i + GLM_CONFIG.batchSize < textsToTranslate.length) {
                showTranslateStatus(statusMessage, 0, null, progressInfo);
              }
              
              // 批次间延迟，避免API限制
              if (i + GLM_CONFIG.batchSize < textsToTranslate.length) {
                await new Promise(resolve => setTimeout(resolve, GLM_CONFIG.batchDelay));
              }
            }
            
            currentLanguage = targetLang;
            console.log(`🎯 当前语言已更新为: ${LANGUAGE_MAP[targetLang]}`);
            
            try {
              saveCurrentPageState();
              savePersistentCache();
            } catch (saveError) {
              console.warn('⚠️ 保存状态失败:', saveError);
            }
            
            const totalProcessed = translatedCount + skippedCount + failedCount;
            
            // 立即清除任何正在显示的进度状态
            const existingStatus = document.getElementById('translate-status');
            if (existingStatus) {
              existingStatus.remove();
            }
            
            if (totalProcessed === 0) {
              showTranslateStatus('页面无需翻译', 2000);
            } else if (translatedCount === 0 && skippedCount > 0 && failedCount === 0) {
              // 只有跳过，没有失败 - 说明内容已经是目标语言
              showTranslateStatus(`页面内容已是${LANGUAGE_MAP[targetLang]} ✅`, 2500);
            } else if (translatedCount === 0 && failedCount > 0) {
              // 没有成功翻译，但有失败项目 - 智能显示
              const failureRatio = failedCount / totalProcessed;
              if (skippedCount > failedCount * 5) {
                // 跳过的远多于失败的，说明大部分内容不需要翻译
                showTranslateStatus(`页面内容已是${LANGUAGE_MAP[targetLang]} ✅`, 2500);
              } else if (failureRatio < 0.3) {
                // 失败率低于30%，认为翻译基本成功
                showTranslateStatus(`翻译完成 ✅`, 2500);
              } else {
                // 失败较多，显示友好的失败消息
                showTranslateStatus('部分内容翻译失败，请重试', 3000);
              }
            } else if (translatedCount > 0) {
              const successRate = Math.round((translatedCount / totalProcessed) * 100);
              let finalMessage = `翻译完成! ✅${translatedCount}`;
              
              if (skippedCount > 0) finalMessage += ` ⏭️${skippedCount}`;
              if (failedCount > 0) finalMessage += ` ❌${failedCount}`;
              
              if (successRate >= 90) {
                finalMessage += ` 🎉`;
              } else if (successRate >= 70) {
                finalMessage += ` ✨`;
              } else if (failedCount > translatedCount) {
                finalMessage += ` ⚠️`;
              }
              
              showTranslateStatus(finalMessage, 3000);
            } else {
              // 兜底情况 - 应该很少触发
              showTranslateStatus('翻译处理完成', 2000);
            }
            
            console.log(`✅ 翻译完成 - 成功: ${translatedCount}, 跳过: ${skippedCount}, 失败: ${failedCount}`);
            
          } catch (error) {
            console.error('💥 翻译过程发生错误:', error);
            
            // 清除任何正在显示的进度状态
            const existingStatus = document.getElementById('translate-status'); 
            if (existingStatus) {
              existingStatus.remove();
            }
            
            showTranslateStatus('翻译失败，请重试', 3000);
            
            // 错误时重置为中文状态
            if (originalTexts.size > 0) {
              originalTexts.forEach((originalText, node) => {
                if (node.parentNode) {
                  node.textContent = originalText;
                }
              });
            }
            currentLanguage = 'chinese_simplified';
          } finally {
            // 重置翻译状态和中断控制
            isTranslating = false;
            shouldCancelTranslation = false;
            translationAbortController = null;
          }
        }
        
        // 创建智能用户选择弹窗 - 修复语言一致性和逻辑
        function createTranslationChoiceDialog() {
          return new Promise((resolve) => {
            // 获取当前状态信息
            const hasGlobalPreference = globalTranslationPreference && 
                                      globalTranslationPreference !== 'chinese_simplified' &&
                                      LANGUAGE_MAP[globalTranslationPreference];
            
            const otherPageCount = Array.from(pageTranslationStates.values()).filter(state => 
              state.language && 
              state.language !== 'chinese_simplified' &&
              LANGUAGE_MAP[state.language] &&
              state.timestamp &&
              (Date.now() - state.timestamp < CACHE_MAX_AGE)
            ).length;
            
            // 如果没有全局偏好也没有其他页面状态，直接返回仅当前页面
            if (!hasGlobalPreference && otherPageCount === 0) {
              resolve('currentPageOnly');
              return;
            }
            
            // 创建弹窗容器
            const dialog = document.createElement('div');
            dialog.style.cssText = `
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.6);
              display: flex;
              justify-content: center;
              align-items: center;
              z-index: 10000;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              backdrop-filter: blur(4px);
              animation: dialogBackdropFadeIn 0.3s ease-out;
            `;
            
            // 创建弹窗内容
            const content = document.createElement('div');
            content.style.cssText = `
              background: white;
              border-radius: 16px;
              padding: 32px;
              max-width: 480px;
              width: 90%;
              box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
              text-align: center;
              animation: dialogContentFadeIn 0.4s ease-out;
              border: 1px solid rgba(0, 0, 0, 0.1);
            `;
            
            // 添加动画样式
            const style = document.createElement('style');
            style.textContent = `
              @keyframes dialogBackdropFadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
              }
              @keyframes dialogContentFadeIn {
                from {
                  opacity: 0;
                  transform: scale(0.9) translateY(-20px);
                }
                to {
                  opacity: 1;
                  transform: scale(1) translateY(0);
                }
              }
              .dialog-button {
                transition: all 0.2s ease;
              }
              .dialog-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
              }
            `;
            document.head.appendChild(style);
            
            // 根据当前语言获取弹窗文本 - 修复语言一致性
            const getDialogTexts = (lang) => {
              const texts = {
                'chinese_simplified': {
                  title: '翻译设置选择',
                  question: '您希望如何处理翻译状态？',
                  currentPageBtn: '仅恢复当前页面',
                  currentPageDesc: '保留其他页面的翻译设置',
                  clearAllBtn: '清除所有翻译设置',
                  clearAllDesc: '所有页面都将恢复中文',
                  tip: '💡 提示：您可以随时重新设置翻译偏好',
                  globalPref: '当前全局翻译偏好',
                  pagesCount: '个页面保存了翻译状态',
                  hasPages: '有',
                  and: '，还有'
                },
                'english': {
                  title: 'Translation Settings',
                  question: 'How would you like to handle the translation state?',
                  currentPageBtn: 'Restore Current Page Only',
                  currentPageDesc: 'Keep translation settings for other pages',
                  clearAllBtn: 'Clear All Translation Settings',
                  clearAllDesc: 'All pages will be restored to Chinese',
                  tip: '💡 Tip: You can reset translation preferences anytime',
                  globalPref: 'Current global translation preference',
                  pagesCount: 'pages have saved translation states',
                  hasPages: '',
                  and: ', and '
                },
                'korean': {
                  title: '번역 설정',
                  question: '번역 상태를 어떻게 처리하시겠습니까?',
                  currentPageBtn: '현재 페이지만 복원',
                  currentPageDesc: '다른 페이지의 번역 설정 유지',
                  clearAllBtn: '모든 번역 설정 지우기',
                  clearAllDesc: '모든 페이지가 중국어로 복원됩니다',
                  tip: '💡 팁: 언제든지 번역 기본 설정을 재설정할 수 있습니다',
                  globalPref: '현재 전역 번역 기본 설정',
                  pagesCount: '개 페이지에 번역 상태가 저장되어 있습니다',
                  hasPages: '',
                  and: ', 그리고 '
                },
                'japanese': {
                  title: '翻訳設定',
                  question: '翻訳状態をどのように処理しますか？',
                  currentPageBtn: '現在のページのみ復元',
                  currentPageDesc: '他のページの翻訳設定を保持',
                  clearAllBtn: 'すべての翻訳設定をクリア',
                  clearAllDesc: 'すべてのページが中国語に復元されます',
                  tip: '💡 ヒント：いつでも翻訳設定をリセットできます',
                  globalPref: '現在のグローバル翻訳設定',
                  pagesCount: 'ページに翻訳状態が保存されています',
                  hasPages: '',
                  and: '、および'
                }
              };
              return texts[lang] || texts['chinese_simplified'];
            };
            
            // 使用当前语言显示弹窗 - 关键修复
            const dialogTexts = getDialogTexts(currentLanguage);
            
            // 智能生成提示信息
            let statusInfo = '';
            if (hasGlobalPreference && otherPageCount > 0) {
              statusInfo = `${dialogTexts.globalPref}：${LANGUAGE_MAP[globalTranslationPreference]}${dialogTexts.and}${otherPageCount} ${dialogTexts.pagesCount}`;
            } else if (hasGlobalPreference) {
              statusInfo = `${dialogTexts.globalPref}：${LANGUAGE_MAP[globalTranslationPreference]}`;
            } else if (otherPageCount > 0) {
              statusInfo = `${dialogTexts.hasPages} ${otherPageCount} ${dialogTexts.pagesCount}`;
            }
            
            content.innerHTML = `
              <div style="margin-bottom: 24px;">
                <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                  <span style="font-size: 28px; color: white;">🌍</span>
                </div>
                <h3 style="margin: 0 0 12px 0; color: #2d3748; font-size: 20px; font-weight: 700;">${dialogTexts.title}</h3>
                ${statusInfo ? `<div style="margin: 0 0 20px 0; padding: 12px 16px; background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); border-radius: 8px; border-left: 4px solid #4299e1;"><p style="margin: 0; color: #2d3748; font-size: 13px; font-weight: 500;">${statusInfo}</p></div>` : ''}
                <p style="margin: 0 0 28px 0; color: #4a5568; line-height: 1.6; font-size: 15px;">${dialogTexts.question}</p>
              </div>
              <div style="display: flex; flex-direction: column; gap: 16px;">
                <button id="currentPageOnly" class="dialog-button" style="
                  background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
                  border: 2px solid #e2e8f0;
                  border-radius: 12px;
                  padding: 16px 24px;
                  cursor: pointer;
                  font-size: 14px;
                  color: #2d3748;
                  font-weight: 600;
                  text-align: left;
                ">
                  <div style="font-weight: 700; margin-bottom: 6px; color: #1a202c;">${dialogTexts.currentPageBtn}</div>
                  <div style="font-size: 12px; color: #718096; font-weight: 500;">${dialogTexts.currentPageDesc}</div>
                </button>
                <button id="clearGlobalPreference" class="dialog-button" style="
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  border: none;
                  border-radius: 12px;
                  padding: 16px 24px;
                  cursor: pointer;
                  font-size: 14px;
                  color: white;
                  font-weight: 600;
                  text-align: left;
                  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
                ">
                  <div style="font-weight: 700; margin-bottom: 6px;">${dialogTexts.clearAllBtn}</div>
                  <div style="font-size: 12px; opacity: 0.9; font-weight: 500;">${dialogTexts.clearAllDesc}</div>
                </button>
              </div>
              <p style="margin: 24px 0 0 0; font-size: 12px; color: #a0aec0; line-height: 1.5; font-weight: 500;">${dialogTexts.tip}</p>
            `;
            
            dialog.appendChild(content);
            document.body.appendChild(dialog);
            
            // 添加按钮事件
            const currentPageBtn = content.querySelector('#currentPageOnly');
            const clearGlobalBtn = content.querySelector('#clearGlobalPreference');
            
            // 增强的按钮交互效果
            currentPageBtn.addEventListener('mouseenter', () => {
              currentPageBtn.style.background = 'linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%)';
              currentPageBtn.style.borderColor = '#cbd5e0';
            });
            currentPageBtn.addEventListener('mouseleave', () => {
              currentPageBtn.style.background = 'linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%)';
              currentPageBtn.style.borderColor = '#e2e8f0';
            });
            
            clearGlobalBtn.addEventListener('mouseenter', () => {
              clearGlobalBtn.style.background = 'linear-gradient(135deg, #5a67d8 0%, #667eea 100%)';
            });
            clearGlobalBtn.addEventListener('mouseleave', () => {
              clearGlobalBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            });
            
            // 安全的弹窗关闭函数
            const closeDialog = (choice) => {
              try {
                dialog.style.animation = 'dialogBackdropFadeOut 0.2s ease-in forwards';
                content.style.animation = 'dialogContentFadeOut 0.2s ease-in forwards';
                
                // 添加退出动画
                const exitStyle = document.createElement('style');
                exitStyle.textContent = `
                  @keyframes dialogBackdropFadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                  }
                  @keyframes dialogContentFadeOut {
                    from {
                      opacity: 1;
                      transform: scale(1) translateY(0);
                    }
                    to {
                      opacity: 0;
                      transform: scale(0.9) translateY(-20px);
                    }
                  }
                `;
                document.head.appendChild(exitStyle);
                
                setTimeout(() => {
                  if (document.body.contains(dialog)) {
                    document.body.removeChild(dialog);
                  }
                  if (document.head.contains(style)) {
                    document.head.removeChild(style);
                  }
                  if (document.head.contains(exitStyle)) {
                    document.head.removeChild(exitStyle);
                  }
                  resolve(choice);
                }, 200);
              } catch (error) {
                console.warn('⚠️ 关闭弹窗时出错:', error);
                resolve(choice);
              }
            };
            
            // 点击事件（增加防抖处理）
            let isClosing = false;
            
            currentPageBtn.addEventListener('click', () => {
              if (!isClosing) {
                isClosing = true;
                closeDialog('currentPageOnly');
              }
            });
            
            clearGlobalBtn.addEventListener('click', () => {
              if (!isClosing) {
                isClosing = true;
                closeDialog('clearGlobalPreference');
              }
            });
            
            // 点击背景关闭（默认选择仅恢复当前页面）
            dialog.addEventListener('click', (e) => {
              if (e.target === dialog && !isClosing) {
                isClosing = true;
                closeDialog('currentPageOnly');
              }
            });
            
            // ESC键关闭
            const handleKeyDown = (e) => {
              if (e.key === 'Escape' && !isClosing) {
                isClosing = true;
                document.removeEventListener('keydown', handleKeyDown);
                closeDialog('currentPageOnly');
              }
            };
            document.addEventListener('keydown', handleKeyDown);
          });
        }
        
        // 创建页面导航选择弹窗 - 当切换到中文页面但存在全局翻译偏好时使用
        function createNavigationChoiceDialog(globalLanguage) {
          return new Promise((resolve) => {
            // 创建弹窗容器
            const dialog = document.createElement('div');
            dialog.style.cssText = `
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              display: flex;
              justify-content: center;
              align-items: center;
              z-index: 10000;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              backdrop-filter: blur(2px);
            `;
            
            // 创建弹窗内容
            const content = document.createElement('div');
            content.style.cssText = `
              background: white;
              border-radius: 12px;
              padding: 24px;
              max-width: 420px;
              width: 90%;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
              text-align: center;
              animation: dialogFadeIn 0.3s ease-out;
            `;
            
            // 添加动画样式
            const style = document.createElement('style');
            style.textContent = `
              @keyframes dialogFadeIn {
                from {
                  opacity: 0;
                  transform: scale(0.9) translateY(-20px);
                }
                to {
                  opacity: 1;
                  transform: scale(1) translateY(0);
                }
              }
            `;
            document.head.appendChild(style);
            
            // 根据全局翻译语言获取弹窗文本
            const getNavigationDialogTexts = (lang) => {
              const texts = {
                'chinese_simplified': {
                  title: '页面翻译选择',
                  question: '检测到当前页面为中文，您希望如何处理？',
                  keepChineseBtn: '保持当前页面为中文',
                  keepChineseDesc: '此页面将保持中文状态',
                  applyGlobalBtn: '应用全局翻译设置',
                  applyGlobalDesc: '翻译此页面为{language}',
                  tip: '💡 提示：您的选择将被记住，下次访问此页面时会自动应用'
                },
                'english': {
                  title: 'Page Translation Choice',
                  question: 'This page is in Chinese. How would you like to proceed?',
                  keepChineseBtn: 'Keep Page in Chinese',
                  keepChineseDesc: 'This page will remain in Chinese',
                  applyGlobalBtn: 'Apply Global Translation',
                  applyGlobalDesc: 'Translate this page to {language}',
                  tip: '💡 Tip: Your choice will be remembered for future visits to this page'
                },
                'korean': {
                  title: '페이지 번역 선택',
                  question: '현재 페이지가 중국어입니다. 어떻게 처리하시겠습니까?',
                  keepChineseBtn: '중국어로 유지',
                  keepChineseDesc: '이 페이지는 중국어로 유지됩니다',
                  applyGlobalBtn: '전역 번역 적용',
                  applyGlobalDesc: '이 페이지를 {language}로 번역',
                  tip: '💡 팁: 선택사항이 기억되어 다음에 이 페이지를 방문할 때 자동 적용됩니다'
                },
                'japanese': {
                  title: 'ページ翻訳の選択',
                  question: '現在のページは中国語です。どのように処理しますか？',
                  keepChineseBtn: '中国語のまま保持',
                  keepChineseDesc: 'このページは中国語のままになります',
                  applyGlobalBtn: 'グローバル翻訳を適用',
                  applyGlobalDesc: 'このページを{language}に翻訳',
                  tip: '💡 ヒント: 選択内容が記憶され、次回このページを訪問時に自動適用されます'
                }
              };
              return texts[lang] || texts['chinese_simplified'];
            };
            
            const dialogTexts = getNavigationDialogTexts(globalLanguage);
            const targetLanguageName = LANGUAGE_MAP[globalLanguage] || globalLanguage;
            
            content.innerHTML = `
              <div style="margin-bottom: 20px;">
                <div style="width: 48px; height: 48px; background: #e8f4f8; border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center;">
                  <span style="font-size: 24px;">🌏</span>
                </div>
                <h3 style="margin: 0 0 8px 0; color: #333; font-size: 18px; font-weight: 600;">${dialogTexts.title}</h3>
                <p style="margin: 0 0 16px 0; color: #666; font-size: 13px; background: #f0f8ff; padding: 8px 12px; border-radius: 6px; border-left: 3px solid #3498db;">
                  当前全局翻译设置：${targetLanguageName}
                </p>
                <p style="margin: 0 0 24px 0; color: #666; line-height: 1.5; font-size: 14px;">${dialogTexts.question}</p>
              </div>
              <div style="display: flex; flex-direction: column; gap: 12px;">
                <button id="keepChinese" style="
                  background: #f8f9fa;
                  border: 1px solid #dee2e6;
                  border-radius: 8px;
                  padding: 14px 20px;
                  cursor: pointer;
                  font-size: 14px;
                  color: #495057;
                  transition: all 0.2s;
                  font-weight: 500;
                ">
                  <div style="font-weight: 600; margin-bottom: 4px;">${dialogTexts.keepChineseBtn}</div>
                  <div style="font-size: 12px; color: #6c757d;">${dialogTexts.keepChineseDesc}</div>
                </button>
                <button id="applyGlobal" style="
                  background: #3498db;
                  border: none;
                  border-radius: 8px;
                  padding: 14px 20px;
                  cursor: pointer;
                  font-size: 14px;
                  color: white;
                  transition: all 0.2s;
                  font-weight: 500;
                ">
                  <div style="font-weight: 600; margin-bottom: 4px;">${dialogTexts.applyGlobalBtn}</div>
                  <div style="font-size: 12px; opacity: 0.9;">${dialogTexts.applyGlobalDesc.replace('{language}', targetLanguageName)}</div>
                </button>
              </div>
              <p style="margin: 20px 0 0 0; font-size: 12px; color: #999; line-height: 1.4;">${dialogTexts.tip}</p>
            `;
            
            dialog.appendChild(content);
            document.body.appendChild(dialog);
            
            // 添加按钮事件
            const keepChineseBtn = content.querySelector('#keepChinese');
            const applyGlobalBtn = content.querySelector('#applyGlobal');
            
            // 增强的按钮悬停效果
            keepChineseBtn.addEventListener('mouseenter', () => {
              keepChineseBtn.style.background = '#e9ecef';
              keepChineseBtn.style.borderColor = '#adb5bd';
              keepChineseBtn.style.transform = 'translateY(-1px)';
            });
            keepChineseBtn.addEventListener('mouseleave', () => {
              keepChineseBtn.style.background = '#f8f9fa';
              keepChineseBtn.style.borderColor = '#dee2e6';
              keepChineseBtn.style.transform = 'translateY(0)';
            });
            
            applyGlobalBtn.addEventListener('mouseenter', () => {
              applyGlobalBtn.style.background = '#2980b9';
              applyGlobalBtn.style.transform = 'translateY(-1px)';
            });
            applyGlobalBtn.addEventListener('mouseleave', () => {
              applyGlobalBtn.style.background = '#3498db';
              applyGlobalBtn.style.transform = 'translateY(0)';
            });
            
            // 安全的弹窗关闭函数
            const closeDialog = (choice) => {
              try {
                if (document.body.contains(dialog)) {
                  document.body.removeChild(dialog);
                }
                if (document.head.contains(style)) {
                  document.head.removeChild(style);
                }
                resolve(choice);
              } catch (error) {
                console.warn('⚠️ 关闭导航选择弹窗时出错:', error);
                resolve(choice);
              }
            };
            
            // 点击事件（增加防抖处理）
            let isClosing = false;
            
            keepChineseBtn.addEventListener('click', () => {
              if (!isClosing) {
                isClosing = true;
                closeDialog('keepChinese');
              }
            });
            
            applyGlobalBtn.addEventListener('click', () => {
              if (!isClosing) {
                isClosing = true;
                closeDialog('applyGlobal');
              }
            });
            
            // 点击背景关闭（默认保持中文）
            dialog.addEventListener('click', (e) => {
              if (e.target === dialog && !isClosing) {
                isClosing = true;
                closeDialog('keepChinese');
              }
            });
            
            // ESC键关闭
            const handleKeyDown = (e) => {
              if (e.key === 'Escape' && !isClosing) {
                isClosing = true;
                document.removeEventListener('keydown', handleKeyDown);
                closeDialog('keepChinese');
              }
            };
            document.addEventListener('keydown', handleKeyDown);
          });
        }
        
        // 处理导航选择的结果
        async function handleNavigationChoice(choice, globalLanguage, pageKey) {
          try {
            if (choice === 'keepChinese') {
              // 用户选择保持中文
              console.log('📝 用户选择保持当前页面为中文');
              
              // 设置页面明确的中文状态
              pageTranslationStates.set(pageKey, {
                language: 'chinese_simplified',
                timestamp: Date.now(),
                url: window.location.href,
                explicit: true // 标记为用户明确选择
              });
              
              currentLanguage = 'chinese_simplified';
              savePersistentCache();
              
              // 使用当前语言显示状态信息
              const statusMessages = {
                'english': 'Page kept in Chinese',
                'korean': '페이지를 중국어로 유지',
                'japanese': 'ページは中国語のまま',
                'chinese_simplified': '页面保持中文'
              };
              const message = statusMessages[globalLanguage] || statusMessages['chinese_simplified'];
              showTranslateStatus(message, 2000);
              
            } else if (choice === 'applyGlobal') {
              // 用户选择应用全局翻译
              console.log(`🌐 用户选择应用全局翻译: ${LANGUAGE_MAP[globalLanguage]}`);
              
              // 执行翻译
              await translatePage(globalLanguage, true);
              
              // 验证翻译是否成功
              if (currentLanguage === globalLanguage) {
                // 保存翻译状态
                saveCurrentPageState();
                
                // 使用目标语言显示状态信息
                const statusMessages = {
                  'english': `Translated to English`,
                  'korean': `한국어로 번역됨`,
                  'japanese': `日本語に翻訳されました`,
                  'chinese_simplified': `已翻译为${LANGUAGE_MAP[globalLanguage]}`
                };
                const message = statusMessages[globalLanguage] || `已翻译为${LANGUAGE_MAP[globalLanguage]}`;
                showTranslateStatus(message, 2000);
                
                console.log('✅ 页面导航翻译完成');
              } else {
                throw new Error('翻译验证失败');
              }
            }
          } catch (error) {
            console.error('💥 处理导航选择失败:', error);
            // 出错时保持中文状态
            currentLanguage = 'chinese_simplified';
            showTranslateStatus('处理失败，保持中文状态', 2000);
          }
        }
        
        // 增强版翻译函数 - 修复恢复逻辑和语言一致性，支持中断
        window.translateTo = async (language) => {
          if (!LANGUAGE_MAP[language]) {
            console.warn(`❌ 不支持的语言: ${language}`);
            showTranslateStatus('不支持的语言', 2000);
            return false;
          }
          
          // 优化的中断处理逻辑
          if (isTranslating) {
            if (language === 'chinese_simplified') {
              // 用户切换到中文，立即中断并恢复
              console.log('🛑 用户切换到中文，中断当前翻译并立即恢复');
              await cancelCurrentTranslation('用户切换到中文');
              
              // 确保语言状态正确设置
              currentLanguage = 'chinese_simplified';
              
              // 保存当前页面状态
              const pageKey = getCurrentPageKey();
              pageTranslationStates.set(pageKey, {
                language: 'chinese_simplified',
                timestamp: Date.now(),
                url: window.location.href,
                explicit: true // 标记为用户明确选择的状态
              });
              
              try {
                savePersistentCache();
              } catch (error) {
                console.warn('⚠️ 保存状态失败:', error);
              }
              
              showTranslateStatus('已恢复中文', 2000);
              console.log('✅ 翻译中断并恢复中文完成');
              return true;
              
            } else if (language !== currentLanguage) {
              // 用户切换到其他语言，中断当前翻译并切换
              console.log('🔄 用户切换翻译语言，中断当前翻译');
              await cancelCurrentTranslation('切换翻译语言');
            } else {
              console.log('🎯 目标语言与当前语言相同，跳过处理');
              showTranslateStatus(`当前已是${LANGUAGE_MAP[language]}`, 2000);
              return true;
            }
          }
          
          try {
            console.log(`🎯 开始翻译: ${LANGUAGE_MAP[currentLanguage]} -> ${LANGUAGE_MAP[language]}`);
            
            // 如果目标语言与当前语言相同，跳过处理
            if (language === currentLanguage) {
              console.log('🎯 目标语言与当前语言相同，跳过处理');
              showTranslateStatus(`当前已是${LANGUAGE_MAP[language]}`, 2000);
              return true;
            }
            
            if (language === 'chinese_simplified') {
              // 恢复中文 - 修复弹窗逻辑
              console.log('🔄 恢复中文状态，检查是否需要用户选择');
              
              // 关键修复：检查当前语言是否为中文，如果已经是中文则无需弹窗
              if (currentLanguage === 'chinese_simplified') {
                console.log('🎯 当前已是中文，无需处理');
                showTranslateStatus('当前已是中文', 2000);
                return true;
              }
              
              const hasGlobalPreference = globalTranslationPreference && 
                                        globalTranslationPreference !== 'chinese_simplified' &&
                                        LANGUAGE_MAP[globalTranslationPreference];
              
              const otherPagesCount = Array.from(pageTranslationStates.values()).filter(state => 
                state.language && 
                state.language !== 'chinese_simplified' &&
                LANGUAGE_MAP[state.language] &&
                state.timestamp &&
                (Date.now() - state.timestamp < CACHE_MAX_AGE)
              ).length;
              
              let userChoice = 'currentPageOnly';
              
              // 修复弹窗显示逻辑：只有在有其他翻译状态时才显示弹窗
              if (hasGlobalPreference || otherPagesCount > 0) {
                console.log('🔄 显示用户选择弹窗');
                try {
                  userChoice = await createTranslationChoiceDialog();
                  console.log(`👤 用户选择: ${userChoice}`);
                } catch (error) {
                  console.warn('⚠️ 用户选择弹窗失败，使用默认选择:', error);
                  userChoice = 'currentPageOnly';
                }
              }
              
              // 恢复当前页面为中文
              await translatePage(language, false);
              
              if (userChoice === 'clearGlobalPreference') {
                // 清除所有翻译设置
                console.log('🧹 清除所有翻译设置');
                globalTranslationPreference = null;
                pageTranslationStates.clear();
                
                showTranslateStatus('已清除所有翻译设置', 2500);
              } else {
                // 仅恢复当前页面，保留其他设置
                console.log('📝 仅恢复当前页面，保留其他翻译设置');
                
                // 明确保存当前页面的中文状态，确保不受全局偏好影响
                const pageKey = getCurrentPageKey();
                pageTranslationStates.set(pageKey, {
                  language: 'chinese_simplified',
                  timestamp: Date.now(),
                  url: window.location.href,
                  explicit: true // 标记为用户明确选择的状态
                });
                
                console.log(`📄 已明确设置页面 ${pageKey} 为中文状态，不受全局偏好影响`);
                showTranslateStatus('已恢复当前页面，其他页面保持翻译状态', 2500);
              }
              
              currentLanguage = 'chinese_simplified';
              
            } else {
              // 翻译到其他语言
              console.log(`🌍 翻译到: ${LANGUAGE_MAP[language]}`);
              
              await translatePage(language, false);
              
              // 验证翻译是否成功
              if (currentLanguage === language && originalTexts.size > 0) {
                // 设置全局翻译偏好
                globalTranslationPreference = language;
                console.log(`🌐 全局翻译偏好已设置为: ${LANGUAGE_MAP[language]}`);
                
                // 保存当前页面状态
                saveCurrentPageState();
                
                // 使用目标语言显示通知
                const successMessages = {
                  'english': `已翻译为English`,
                  'korean': `이미 한국어로 번역됨`,
                  'japanese': `日本語に翻訳されました`
                };
                const message = successMessages[language] || `已翻译为${LANGUAGE_MAP[language]}`;
                showTranslateStatus(message, 2000, language);
              } else {
                throw new Error('翻译验证失败 - 状态不匹配');
              }
            }
            
            // 保存持久化缓存
            try {
              savePersistentCache();
            } catch (error) {
              console.warn('⚠️ 保存状态失败:', error);
            }
            
            console.log(`✅ 翻译完成: ${LANGUAGE_MAP[currentLanguage]}`);
            return true;
            
          } catch (error) {
            console.error('💥 翻译失败:', error);
            showTranslateStatus('翻译失败，请重试', 3000);
            
            // 错误恢复 - 重置为安全状态
            try {
              if (originalTexts.size > 0) {
                originalTexts.forEach((originalText, node) => {
                  if (node.parentNode) {
                    node.textContent = originalText;
                  }
                });
              }
              
              // 清理翻译标记
              const translatedElements = document.querySelectorAll('[data-translated]');
              translatedElements.forEach(element => {
                const originalText = element.getAttribute('data-original-text');
                if (originalText) {
                  element.textContent = originalText;
                }
                element.removeAttribute('data-translated');
                element.removeAttribute('data-original-text');
              });
              
              currentLanguage = 'chinese_simplified';
              console.log('🔄 已恢复为中文状态');
            } catch (recoveryError) {
              console.error('💥 错误恢复失败:', recoveryError);
            }
            
            return false;
          } finally {
            // 确保总是重置中断控制状态
            shouldCancelTranslation = false;
            if (translationAbortController) {
              translationAbortController = null;
            }
          }
        };
        
        // 页面导航处理
        async function handlePageNavigation() {
          if (isTranslating) {
            console.log('⏸️ 翻译进行中，跳过页面导航处理');
            return;
          }
          
          // 重置导航弹窗标志，允许新页面显示选择弹窗
          navigationDialogShown = false;
          
          console.log('🚀 开始处理页面导航...');
          
          try {
            if (originalTexts.size > 0) {
              saveCurrentPageState();
            }
            
            originalTexts.clear();
            
            const pageKey = getCurrentPageKey();
            const savedState = pageTranslationStates.get(pageKey);
            
            let targetLanguage = 'chinese_simplified';
            let shouldTranslate = false;
            
            const isValidGlobalPreference = globalTranslationPreference && 
                                          globalTranslationPreference !== 'chinese_simplified' && 
                                          LANGUAGE_MAP[globalTranslationPreference];
            
            const isValidPageState = savedState && 
                                    savedState.language && 
                                    LANGUAGE_MAP[savedState.language] &&
                                    savedState.timestamp && 
                                    (Date.now() - savedState.timestamp < CACHE_MAX_AGE);
            
            // 修复：正确处理页面独立状态，避免"仅恢复当前页面"影响其他页面
            if (isValidPageState) {
              if (savedState.language === 'chinese_simplified') {
                // 该页面被明确设置为中文状态，不应用全局翻译偏好
                targetLanguage = 'chinese_simplified';
                currentLanguage = 'chinese_simplified';
                shouldTranslate = false;
                
                const translatedElements = document.querySelectorAll('[data-translated]');
                if (translatedElements.length > 0) {
                  translatedElements.forEach(element => {
                    const originalText = element.getAttribute('data-original-text');
                    if (originalText) {
                      element.textContent = originalText;
                      element.removeAttribute('data-translated');
                      element.removeAttribute('data-original-text');
                    }
                  });
                }
                
                const isExplicit = savedState.explicit ? '（用户明确设置）' : '';
                console.log(`📝 页面导航处理完成，保持中文状态${isExplicit}`);
                return;
              } else {
                // 该页面有有效的翻译状态
                targetLanguage = savedState.language;
                shouldTranslate = true;
                console.log(`📄 使用页面保存的翻译状态: ${LANGUAGE_MAP[targetLanguage]}`);
              }
            } else {
              // 页面没有保存状态，检查是否应用全局偏好
              if (isValidGlobalPreference) {
                // 检测是否需要弹出用户选择框
                // 条件：存在全局翻译偏好，且当前页面为中文状态（无翻译内容）
                const hasTranslatedContent = document.querySelectorAll('[data-translated]').length > 0;
                
                if (!hasTranslatedContent && !navigationDialogShown) {
                  // 页面为中文状态，但有全局翻译偏好，弹出选择框
                  console.log(`🤔 页面为中文但存在全局翻译偏好${LANGUAGE_MAP[globalTranslationPreference]}，弹出用户选择框`);
                  
                  navigationDialogShown = true; // 设置标志防止重复显示
                  
                  setTimeout(async () => {
                    try {
                      const userChoice = await createNavigationChoiceDialog(globalTranslationPreference);
                      await handleNavigationChoice(userChoice, globalTranslationPreference, pageKey);
                    } catch (error) {
                      console.warn('⚠️ 处理导航选择失败:', error);
                      // 默认保持中文状态
                      currentLanguage = 'chinese_simplified';
                    } finally {
                      // 重置标志，允许下次页面导航时再次显示
                      setTimeout(() => {
                        navigationDialogShown = false;
                      }, 2000);
                    }
                  }, 300); // 延迟以确保页面内容加载完成
                  
                  return; // 等待用户选择，不执行后续逻辑
                } else {
                  // 页面已有翻译内容，直接应用全局偏好
                  targetLanguage = globalTranslationPreference;
                  shouldTranslate = true;
                  console.log(`🌐 应用全局翻译偏好: ${LANGUAGE_MAP[targetLanguage]} (页面无明确状态)`);
                }
              } else {
                // 没有全局偏好，保持中文
                targetLanguage = 'chinese_simplified';
                shouldTranslate = false;
                console.log('📝 页面无状态且无全局偏好，保持中文');
              }
            }
            
            currentLanguage = targetLanguage;
            
            if (shouldTranslate) {
              console.log(`🔄 开始自动翻译到: ${LANGUAGE_MAP[targetLanguage]}`);
              
              setTimeout(async () => {
                try {
                  await translatePage(targetLanguage, true);
                  console.log('✅ 翻译状态自动恢复成功');
                } catch (error) {
                  console.warn('⚠️ 自动恢复翻译失败:', error);
                  currentLanguage = 'chinese_simplified';
                }
              }, 500);
            }
            
            try {
              savePersistentCache();
            } catch (error) {
              console.warn('⚠️ 保存状态失败:', error);
            }
            
            console.log('🎉 页面导航处理完成，当前语言:', LANGUAGE_MAP[currentLanguage]);
            
          } catch (error) {
            console.error('💥 页面导航处理失败:', error);
            currentLanguage = 'chinese_simplified';
            globalTranslationPreference = null;
            originalTexts.clear();
            
            try {
              savePersistentCache();
            } catch (saveError) {
              console.warn('⚠️ 保存重置状态失败:', saveError);
            }
          }
        }
        
        // 页面导航监听器
        function setupNavigationObserver() {
          let navigationTimeout = null;
          let isNavigating = false;
          
          const handlePageChange = async () => {
            if (isNavigating) return;
            isNavigating = true;
            
            try {
              const currentUrl = window.location.href;
              if (currentUrl !== lastUrl) {
                console.log('🔄 页面导航检测:', lastUrl, '->', currentUrl);
                lastUrl = currentUrl;
                
                await new Promise(resolve => {
                  if (document.readyState === 'complete') {
                    resolve();
                  } else {
                    const onReady = () => {
                      if (document.readyState === 'complete') {
                        document.removeEventListener('readystatechange', onReady);
                        resolve();
                      }
                    };
                    document.addEventListener('readystatechange', onReady);
                  }
                });
                
                await new Promise(resolve => setTimeout(resolve, 200));
                await handlePageNavigation();
              }
            } catch (error) {
              console.error('页面变化处理失败:', error);
            } finally {
              isNavigating = false;
            }
          };
          
          const debouncedPageChange = () => {
            if (navigationTimeout) {
              clearTimeout(navigationTimeout);
            }
            navigationTimeout = setTimeout(handlePageChange, 100);
          };
          
          window.addEventListener('popstate', debouncedPageChange);
          
          const originalPushState = history.pushState;
          const originalReplaceState = history.replaceState;
          
          history.pushState = function(...args) {
            originalPushState.apply(this, args);
            setTimeout(debouncedPageChange, 50);
          };
          
          history.replaceState = function(...args) {
            originalReplaceState.apply(this, args);
            setTimeout(debouncedPageChange, 50);
          };
          
          if (window.document$ && typeof window.document$.subscribe === 'function') {
            window.document$.subscribe(() => {
              console.log('📄 Material for MkDocs 页面变化事件');
              setTimeout(debouncedPageChange, 150);
            });
          }
          
          window.addEventListener('beforeunload', () => {
            if (navigationTimeout) clearTimeout(navigationTimeout);
          });
        }
        
        // 工具方法
        window.getCurrentLanguage = () => {
          if (!currentLanguage || !LANGUAGE_MAP[currentLanguage]) {
            currentLanguage = 'chinese_simplified';
          }
          return currentLanguage;
        };
        
        window.getCurrentLanguageName = () => LANGUAGE_MAP[window.getCurrentLanguage()] || '中文';
        
        window.clearTranslateCache = () => {
          try {
            translationCache.clear();
            pageTranslationStates.clear();
            originalTexts.clear();
            globalTranslationPreference = null;
            currentLanguage = 'chinese_simplified';
            
            [STORAGE_PREFIX + 'cache', STORAGE_PREFIX + 'preference', STORAGE_PREFIX + 'states'].forEach(key => {
              try { localStorage.removeItem(key); } catch (e) {}
            });
            
            console.log('✅ 所有翻译缓存和状态已清除');
            showTranslateStatus('缓存已清除，重置为中文', 2000);
            
          } catch (error) {
            console.error('💥 清除缓存时发生错误:', error);
            showTranslateStatus('清除缓存失败', 2000);
          }
        };
        
        // 初始化函数
        function initGLMTranslate() {
          try {
            console.log('🚀 开始初始化GLM翻译功能...');
            
            initPersistentCache();
            console.log('💾 缓存初始化完成');
            
            // 初始化性能优化组件
            try {
              TranslationWorkerManager.init();
              console.log('👨‍💻 Web Workers 初始化完成');
            } catch (workerError) {
              console.warn('⚠️ Web Workers 初始化失败，将使用主线程翻译:', workerError);
            }
            
            try {
              VirtualScrollOptimizer.init();
              console.log('📱 虚拟滚动优化器初始化完成');
            } catch (scrollError) {
              console.warn('⚠️ 虚拟滚动优化器初始化失败:', scrollError);
            }
            
            // 初始化快捷键支持
            try {
              ShortcutManager.init();
              console.log('⌨️ 快捷键管理器初始化完成');
            } catch (shortcutError) {
              console.warn('⚠️ 快捷键管理器初始化失败:', shortcutError);
            }
            
            setupNavigationObserver();
            console.log('👁️ 导航监听器设置完成');
            
            const pageKey = getCurrentPageKey();
            const savedState = pageTranslationStates.get(pageKey);
            
            const isValidPageState = savedState && 
                                    savedState.language && 
                                    LANGUAGE_MAP[savedState.language] &&
                                    savedState.timestamp && 
                                    (Date.now() - savedState.timestamp < CACHE_MAX_AGE);
            
            const isValidGlobalPreference = globalTranslationPreference && 
                                          globalTranslationPreference !== 'chinese_simplified' && 
                                          LANGUAGE_MAP[globalTranslationPreference];
            
            let shouldAutoTranslate = false;
            let targetLanguage = 'chinese_simplified';
            
            if (isValidPageState) {
              if (savedState.language === 'chinese_simplified') {
                const isExplicit = savedState.explicit ? '（用户明确设置）' : '';
                console.log(`📝 检测到页面明确设置为中文状态${isExplicit}`);
                targetLanguage = 'chinese_simplified';
                currentLanguage = 'chinese_simplified';
                shouldAutoTranslate = false;
                
                originalTexts.clear();
                
                const translatedElements = document.querySelectorAll('[data-translated]');
                if (translatedElements.length > 0) {
                  console.log('🔄 初始化时检测到翻译内容，恢复为中文');
                  translatedElements.forEach(element => {
                    const originalText = element.getAttribute('data-original-text');
                    if (originalText) {
                      element.textContent = originalText;
                      element.removeAttribute('data-translated');
                      element.removeAttribute('data-original-text');
                    }
                  });
                }
                
                window.glmTranslateInitialized = true;
                console.log(`✅ GLM翻译功能初始化完成（中文状态${isExplicit}）`);
                return;
              } else {
                console.log(`🔄 检测到有效页面翻译状态: ${LANGUAGE_MAP[savedState.language]}`);
                targetLanguage = savedState.language;
                currentLanguage = savedState.language;
                shouldAutoTranslate = true;
              }
            } else if (isValidGlobalPreference) {
              console.log(`🌐 检测到有效全局翻译偏好: ${LANGUAGE_MAP[globalTranslationPreference]}`);
              targetLanguage = globalTranslationPreference;
              currentLanguage = globalTranslationPreference;
              shouldAutoTranslate = true;
            } else {
              console.log('📝 无有效翻译状态或全局偏好，保持中文状态');
              currentLanguage = 'chinese_simplified';
              
              if (globalTranslationPreference && !LANGUAGE_MAP[globalTranslationPreference]) {
                globalTranslationPreference = null;
                savePersistentCache();
              }
            }
            
            if (shouldAutoTranslate) {
              setTimeout(async () => {
                try {
                  console.log(`🔄 静默恢复翻译状态: ${LANGUAGE_MAP[targetLanguage]}`);
                  await translatePage(targetLanguage, true);
                  console.log('✅ 翻译状态自动恢复成功');
                } catch (error) {
                  console.warn('⚠️ 自动恢复翻译失败:', error);
                  currentLanguage = 'chinese_simplified';
                }
              }, 500);
            }
            
            window.glmTranslateInitialized = true;
            console.log('✅ GLM翻译功能初始化完成');
            console.log('🎯 优化功能状态:');
            console.log(`  - Web Workers: ${TranslationWorkerManager.workers.length > 0 ? '已启用' : '已禁用'}`);
            console.log(`  - 虚拟滚动: ${VirtualScrollOptimizer.observer ? '已启用' : '已禁用'}`);
            console.log(`  - 快捷键支持: ${ShortcutManager.isInitialized ? '已启用' : '已禁用'}`);
            console.log(`  - 语义缓存: ${semanticCache ? '已启用' : '已禁用'}`);
            console.log(`  - 专业术语: ${Object.keys(TECHNICAL_TERMS).length > 0 ? '已启用' : '已禁用'}`);
            
          } catch (error) {
            console.error('💥 GLM翻译功能初始化失败:', error);
            currentLanguage = 'chinese_simplified';
            globalTranslationPreference = null;
          }
        }
        
        if (document.readyState === 'complete') {
          initGLMTranslate();
        } else {
          document.addEventListener('DOMContentLoaded', initGLMTranslate);
        }
        
        // 页面卸载时清理资源
        window.addEventListener('beforeunload', () => {
          try {
            if (TranslationWorkerManager && TranslationWorkerManager.destroy) {
              TranslationWorkerManager.destroy();
            }
            if (VirtualScrollOptimizer && VirtualScrollOptimizer.destroy) {
              VirtualScrollOptimizer.destroy();
            }
            console.log('🧹 翻译功能资源已清理');
          } catch (error) {
            console.warn('⚠️ 清理翻译功能资源时出错:', error);
          }
        });
        
      })();
      </script>

      <!-- 页脚功能脚本 - 已优化 -->
      <script>
        (() => {
          'use strict';
          
          if (window.footerInitialized) return;
          
          const START_DATE = new Date('2022-10-20T00:00:00').getTime();
          let timeUpdateInterval;
          let visitCountObserver;
          
          // 优化的时间计算
          const calculateRuntime = () => {
            const diff = Math.floor((Date.now() - START_DATE) / 1000);
            const days = Math.floor(diff / 86400);
            const hours = Math.floor((diff % 86400) / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            const seconds = diff % 60;
            return `${days}天${hours}时${minutes}分${seconds}秒`;
          };
          
          const updateTime = () => {
            const time = calculateRuntime();
            const desktop = document.getElementById('box1');
            const mobile = document.getElementById('box1_mobile');
            
            if (desktop) desktop.textContent = time;
            if (mobile) mobile.textContent = time;
          };
          
          const loadVisitCounter = () => {
            if (document.querySelector('script[src*="finicounter.eu.org"]')) return;
            
            const script = document.createElement('script');
            script.src = '//finicounter.eu.org/finicounter.js';
            script.async = true;
            script.onerror = () => {
              const desktop = document.getElementById('finicount_views');
              const mobile = document.getElementById('finicount_views_mobile');
              if (desktop) desktop.textContent = '统计中...';
              if (mobile) mobile.textContent = '统计中...';
            };
            document.head.appendChild(script);
          };
          
          const syncVisitCount = () => {
            const desktop = document.getElementById('finicount_views');
            const mobile = document.getElementById('finicount_views_mobile');
            if (desktop?.textContent && mobile && !desktop.textContent.includes('加载中')) {
              mobile.textContent = desktop.textContent;
            }
          };
          
          const setupVisitCountObserver = () => {
            const desktop = document.getElementById('finicount_views');
            if (!desktop) return;
            if (visitCountObserver) visitCountObserver.disconnect();
            visitCountObserver = new MutationObserver(syncVisitCount);
            visitCountObserver.observe(desktop, { childList: true, characterData: true });
          };
          
          const cleanup = () => {
            if (timeUpdateInterval) {
              clearInterval(timeUpdateInterval);
              timeUpdateInterval = null;
            }
            if (visitCountObserver) {
              visitCountObserver.disconnect();
              visitCountObserver = null;
            }
          };
          
          const init = () => {
            cleanup();
            updateTime();
            timeUpdateInterval = setInterval(updateTime, 1000);
            loadVisitCounter();
            setupVisitCountObserver();
          };
          
          if (window.document$ && !window.document$.isStopped) {
            window.document$.subscribe(() => setTimeout(init, 200));
          } else {
            if (document.readyState === 'loading') {
              document.addEventListener('DOMContentLoaded', init);
            } else {
              setTimeout(init, 100);
            }
          }
          
          window.addEventListener('beforeunload', cleanup);
          window.footerInitialized = true;
        })();
      </script>

      <!-- 优化的样式 -->
      <style>
        /* Footer backgrounds */
        .md-footer {
          background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        .md-footer-meta {
          background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        /* Layout containers */
        .footer-wrapper {
          width: 100%;
          padding: 0.2rem 0;
          text-align: center;
        }
        .footer-content {
          max-width: 900px;
          margin: 0 auto;
          padding: 0.4rem 0 0;
          display: flex;
          justify-content: center;
        }
        .footer-bottom-section {
          max-width: 900px;
          margin: 0.4rem auto 0;
          padding: 0.4rem 1rem;
          border-top: 1px solid rgba(255, 255, 255, 0.15);
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        /* Visit count styles */
        .footer-visit-count {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.3rem;
          font-size: 0.75rem;
          color: var(--md-footer-fg-color--light);
          width: 100%;
        }
        .footer-item {
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 0.4rem 0.8rem;
          border-radius: 16px;
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid rgba(255, 255, 255, 0.15);
          -webkit-backdrop-filter: blur(10px);
          backdrop-filter: blur(10px);
          min-width: 160px;
          font-size: 0.8rem;
          transition: all 0.2s ease;
        }
        .footer-item:hover {
          background: rgba(255, 255, 255, 0.15);
          border-color: rgba(81, 143, 193, 0.4);
          transform: translateY(-1px);
        }
        .footer-highlight {
          color: #C2C4C9;
          font-weight: 600;
          margin-left: 0.3rem;
        }

        /* Copyright and social styles */
        .md-footer-copyright {
          text-align: left;
          font-size: 0.75rem;
          opacity: 0.8;
          line-height: 1.2;
        }
        .footer-social {
          display: flex;
          gap: 0.3rem;
          align-items: center;
        }
        .icp-link {
          color: inherit;
          text-decoration: none;
        }
        .icp-link:hover {
          color: #518FC1;
        }

        /* Mobile responsive design */
        @media (max-width: 76.1875em) {
          .footer-visit-count { display: none; }
          .footer-visit-count-mobile {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 0.4em 0.8em;
            padding: 0.2em 0;
            font-size: 0.75rem;
            color: var(--md-footer-fg-color--light);
            text-align: center;
          }
          .footer-bottom-section {
            flex-direction: column;
            gap: 0.6rem;
            text-align: center;
          }
          .md-footer-copyright { text-align: center; }
        }

        /* Desktop specific styles */
        @media (min-width: 76.1875em) {
          .footer-visit-count-mobile { display: none; }
          .footer-visit-count { 
            flex-direction: row; 
            gap: 2rem;
            justify-content: center;
          }
        }
      </style>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "navigation.prune", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "toc.follow", "navigation.expand", "navigation.indexes", "content.tabs.link", "content.tooltips", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/javascripts/unified-instant-handler.js"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/javascripts/extra.js"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/javascripts/view.js"></script>
      
    
  </body>
</html>